<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>月夜静翼的天文台</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="月夜静翼的天文台">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="月夜静翼的天文台">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="月夜静翼">
<meta property="article:tag" content="前端">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="月夜静翼的天文台" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.4.2"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">月夜静翼的天文台</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-js中属性描述符与对象状态" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/01/31/js%E4%B8%AD%E5%B1%9E%E6%80%A7%E6%8F%8F%E8%BF%B0%E7%AC%A6%E4%B8%8E%E5%AF%B9%E8%B1%A1%E7%8A%B6%E6%80%81/" class="article-date">
  <time datetime="2023-01-31T03:22:09.000Z" itemprop="datePublished">2023-01-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/01/31/js%E4%B8%AD%E5%B1%9E%E6%80%A7%E6%8F%8F%E8%BF%B0%E7%AC%A6%E4%B8%8E%E5%AF%B9%E8%B1%A1%E7%8A%B6%E6%80%81/">js中属性描述符与对象状态</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="属性描述符"><a href="#属性描述符" class="headerlink" title="属性描述符"></a>属性描述符</h1><p>对象属性描述符的类型分为两种: 数据属性和访问器属性。</p>
<h2 id="数据属性"><a href="#数据属性" class="headerlink" title="数据属性"></a>数据属性</h2><p>数据属性(data property)包含一个数据值的位置，在这个位置可以读取和写入值。数据属性有4个特性</p>
<ul>
<li><p>Configurable(可配置性): 可配置性决定是否可以<code>delete</code>删除属性，以及是否可以修改属性描述符的特性(<code>Object.defineProperty</code>)，默认值为true。</p>
</li>
<li><p>Enumerable(可枚举性): 可枚举性决定属性是否出现在对象的属性枚举中，比如是否可以通过<code>for-in</code>循环返回该属性，默认值为true。</p>
</li>
<li><p>Writable(可写性): 可写性决定是否可以修改属性的值，默认值为true。 设置<code>writable:false</code>后， 在严格模式下通过赋值语句为writable为false的属性赋值，会提示类型错误<code>TypeError</code>，兼容模式时赋值语句会静默失效 。</p>
</li>
<li><p>Value(属性值): 属性值包含这个属性的数据值，读取属性值的时候，从这个位置读；写入属性值的时候，把新值保存在这个位置。默认值为undefined。</p>
</li>
</ul>
<h2 id="访问器属性"><a href="#访问器属性" class="headerlink" title="访问器属性"></a><strong>访问器属性</strong></h2><p>对象属性是名字、值和一组属性描述符构成的。而属性值可以用一个或两个方法替代，这两个方法就是getter和setter。而这种属性类型叫访问器属性(accessor property) 。</p>
<ul>
<li><p>getter: 在读取属性时调用的函数。默认值为undefined。</p>
</li>
<li><p>setter: 在写入属性时调用的函数。默认值为undefined。</p>
</li>
</ul>
<p>和数据属性不同，访问器属性不具有可写性(Writable)。如果属性同时具有getter和setter方法，那么它是一个读/写属性。如果它只有getter方法，那么它是一个只读属性。如果它只有setter方法，那么它是一个只写属性。读取只写属性总是返回undefined。</p>
<h2 id="描述符方法"><a href="#描述符方法" class="headerlink" title="描述符方法"></a>描述符方法</h2><ul>
<li><code>Object.getOwnPropertyDescriptor</code>: <code>Object.getOwnPropertyDescriptor(o,name)</code>方法用于查询一个属性的描述符，并以对象的形式返回 。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">key</span>: <span class="string">&#x27;hello&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查看obj的属性key的属性描述符</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptor</span>(obj, <span class="string">&#x27;key&#x27;</span>))</span><br><span class="line"><span class="comment">// &#123;value: &quot;value&quot;, writable: true, enumerable: true, configurable: true&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>Object.defineProperty()</code>： <code>Object.defineProperty(o,name,desc)</code>方法用于创建或配置对象的一个属性的描述符，返回配置后的对象。<strong>使用该方法创建或配置对象属性的描述符时，如果不针对该属性进行描述符的配置，则该项描述符默认为false</strong> ，而直接创建对象或调用Object.create()方法创建的属性的描述符默认true。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">6</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">isExtensible</span>(obj)) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 阻止对象扩展</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">preventExtensions</span>(obj)</span><br><span class="line">obj.<span class="property">b</span> = <span class="number">999</span> <span class="comment">// b无法被添加</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj) <span class="comment">// &#123;a: 6&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">isExtensible</span>(obj)) <span class="comment">// false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptor</span>(obj, <span class="string">&#x27;a&#x27;</span>)) <span class="comment">// &#123; value: 6, writable: true, enumerable: true, configurable: true &#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>Object.defineProperties()</code>: <code>Object.defineProperty(o,descriptors)</code>方法用于创建或配置对象的多个属性的描述符，返回配置后的对象 。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">key</span>: <span class="string">&#x27;hello&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj.<span class="property">b</span> = <span class="number">11</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 同时设置多个属性，并返回对象</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">defineProperties</span>(obj, &#123;</span><br><span class="line">  <span class="attr">b</span>: &#123; <span class="attr">writable</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">  <span class="attr">c</span>: &#123; <span class="attr">value</span>: <span class="number">2</span> &#125;</span><br><span class="line">&#125;))</span><br><span class="line"><span class="comment">// &#123; key: &#x27;hello&#x27;, b: 11 &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptor</span>(obj, <span class="string">&#x27;b&#x27;</span>))</span><br><span class="line"><span class="comment">// &#123; value: 11, writable: false, enumerable: true, configurable: true &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptor</span>(obj, <span class="string">&#x27;c&#x27;</span>))</span><br><span class="line"><span class="comment">// &#123;value: 2, writable: false, enumerable: false, configurable: false&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>Object.create()</code>: <code>Object.create(proto,descriptors)</code>方法使用指定的原型和属性来创建一个对象 。</li>
</ul>
<h2 id="描述符详述"><a href="#描述符详述" class="headerlink" title="描述符详述"></a>描述符详述</h2><h3 id="可写性-writable"><a href="#可写性-writable" class="headerlink" title="可写性(writable)"></a><strong>可写性(writable)</strong></h3><p>可写性决定是否可以修改属性的值，默认值为true。</p>
<p>设置<code>writable:false</code>后， 在严格模式下通过赋值语句为<code>writable为false</code>的属性赋值，会提示类型错误<code>TypeError</code>，兼容模式时赋值语句会静默失效 。但是可以通过<code>Object.defineProperty()</code>方法改变属性value的值不会受影响 。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">key</span>: <span class="string">&#x27;hello&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, <span class="string">&#x27;key&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">writable</span>: <span class="literal">false</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">key</span>) <span class="comment">// hello</span></span><br><span class="line">obj.<span class="property">key</span> = <span class="string">&#x27;world&#x27;</span> <span class="comment">// 静默失效</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">key</span>) <span class="comment">// hello</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, <span class="string">&#x27;key&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="string">&#x27;world&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">key</span>) <span class="comment">// world</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptor</span>(obj, <span class="string">&#x27;key&#x27;</span>))</span><br><span class="line"><span class="comment">// &#123;value: &#x27;world&#x27;, writable: false, enumerable: true, configurable: true&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, <span class="string">&#x27;key&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">writable</span>: <span class="literal">true</span></span><br><span class="line">&#125;)</span><br><span class="line">obj.<span class="property">key</span> = <span class="string">&#x27;world&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">key</span>) <span class="comment">// world</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">key</span>: <span class="string">&#x27;hello&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, <span class="string">&#x27;key&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">writable</span>: <span class="literal">false</span></span><br><span class="line">&#125;)</span><br><span class="line">obj.<span class="property">key</span> = <span class="string">&#x27;world&#x27;</span> <span class="comment">// Cannot assign to read only property &#x27;key&#x27; of object &#x27;#&lt;Object&gt;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="可配置性-Configurable"><a href="#可配置性-Configurable" class="headerlink" title="可配置性(Configurable)"></a><strong>可配置性(Configurable)</strong></h3><p>配置性决定是否可以使用defineProperty设置和delete删除属性，以及是否可以修改属性描述符的特性(<code>Object.defineProperty</code>)，默认值为true。</p>
<p>设置<code>Configurable:false</code>后，无法使用delete删除属性， 在严格模式下删除为<code>configurable为false</code>的属性，会提示类型错误<code>TypeError</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">key</span>: <span class="string">&#x27;hello&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, <span class="string">&#x27;key&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">configurable</span>: <span class="literal">false</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">delete</span> obj.<span class="property">key</span> <span class="comment">// 静默失效</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">key</span>) <span class="comment">// hello</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">key</span>: <span class="string">&#x27;hello&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, <span class="string">&#x27;key&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">configurable</span>: <span class="literal">false</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">delete</span> obj.<span class="property">key</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">key</span>) <span class="comment">// hello</span></span><br><span class="line"><span class="comment">// TypeError: Cannot delete property &#x27;key&#x27; of #&lt;Object&gt;</span></span><br></pre></td></tr></table></figure>

<p>一般地，设置<code>Configurable:false</code>后，将无法再使用<code>defineProperty()</code>方法来修改属性描述符</p>
<p>有一个例外，设置<code>Configurable:false</code>后，只允许writable的状态从true变为false 。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">key</span>: <span class="string">&#x27;hello&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, <span class="string">&#x27;key&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">configurable</span>: <span class="literal">false</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不允许修改configurable，并且抛出错误</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, <span class="string">&#x27;key&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">configurable</span>: <span class="literal">true</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// TypeError: Cannot redefine property: key</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">key</span>: <span class="string">&#x27;hello&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, <span class="string">&#x27;key&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">configurable</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">writable</span>: <span class="literal">true</span></span><br><span class="line">&#125;)</span><br><span class="line">obj.<span class="property">key</span> = <span class="string">&#x27;world&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">key</span>) <span class="comment">// world</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 允许修改writable</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, <span class="string">&#x27;key&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">writable</span>: <span class="literal">false</span></span><br><span class="line">&#125;)</span><br><span class="line">obj.<span class="property">key</span> = <span class="string">&#x27;world-s&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">key</span>) <span class="comment">// world</span></span><br></pre></td></tr></table></figure>

<h3 id="可枚举性-Enumerable"><a href="#可枚举性-Enumerable" class="headerlink" title="可枚举性(Enumerable)"></a><strong>可枚举性(Enumerable)</strong></h3><p>可枚举性决定属性是否出现在对象的属性枚举中，具体来说，<code>for-in</code>循环、<code>Object.keys</code>方法、<code>JSON.stringify</code>方法是否会取到该属性 。</p>
<p>用户定义的普通属性默认是可枚举的，而原生继承的属性默认是不可枚举的。</p>
<p><code>propertyIsEnumerable()</code>方法用于判断对象的属性是否可枚举</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">key</span>: <span class="string">&#x27;hello&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;key&#125;</span>-<span class="subst">$&#123;obj[key]&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// key-hello</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="title function_">propertyIsEnumerable</span>(<span class="string">&#x27;key&#x27;</span>)) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, <span class="string">&#x27;key&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">enumerable</span>: <span class="literal">false</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;key&#125;</span>-<span class="subst">$&#123;obj[key]&#125;</span>`</span>)</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// 无输出</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="title function_">propertyIsEnumerable</span>(<span class="string">&#x27;key&#x27;</span>)) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<h3 id="get和set"><a href="#get和set" class="headerlink" title="get和set"></a>get和set</h3><p>get是一个隐藏函数，在获取属性值时调用。set也是一个隐藏函数，在设置属性值时调用，它们的默认值都是undefined。<code>Object.definedProperty()</code>中的get和set对应于对象字面量中get和set方法。</p>
<p>给只设置get方法，没有设置set方法的对象赋值会静默失败，在严格模式下会报错</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">a</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">a</span>) <span class="comment">// 2</span></span><br><span class="line">obj.<span class="property">a</span> = <span class="number">3</span> <span class="comment">// 静默失败</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">a</span>) <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">a</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">a</span>) <span class="comment">// 2</span></span><br><span class="line">obj.<span class="property">a</span> = <span class="number">3</span> <span class="comment">// TypeError: Cannot set property a of #&lt;Object&gt; which has only a getter</span></span><br></pre></td></tr></table></figure>

<p>只设置set方法，而不设置get方法，则对象属性值为undefined</p>
<h1 id="对象状态"><a href="#对象状态" class="headerlink" title="对象状态"></a>对象状态</h1><p>属性描述符只能用来控制对象中一个属性的状态。而如果要控制对象的状态，可以通过以下三个特性进行限制</p>
<h2 id="扩展特性"><a href="#扩展特性" class="headerlink" title="扩展特性"></a>扩展特性</h2><p>如果一个对象可以添加新的属性，则这个对象是可扩展的。<br>让这个对象变的不可扩展，也就是不能再有新的属性。</p>
<p>扩展特性相关方法如下:</p>
<ul>
<li><p><code>Object.isExtensible(obj)</code>: 方法判断一个对象是否是可扩展的（是否可以在它上面添加新的属性）</p>
</li>
<li><p><code>Object.preventExtensions(obj)</code></p>
<ul>
<li>如果一个对象可以添加新的属性，则这个对象是可扩展的。 <code>preventExtensions</code>可以让这个对象变的不可扩展，也就是不能再有新的属性。<br>需要注意的是不可扩展的对象的属性通常仍然可以被删除。</li>
<li>不改变对象中属性的描述符状态</li>
</ul>
</li>
</ul>
<p>尝试给一个不可扩展对象添加新属性的操作将会失败，兼容模式下是静默失败，严格模式下会抛出 TypeError 异常。 <strong><code>Object.preventExtensions</code> 只能阻止一个对象不能再添加新的自身属性，仍然可以为该对象的原型添加属性。</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">6</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">isExtensible</span>(obj)) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 阻止对象扩展</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">preventExtensions</span>(obj)</span><br><span class="line">obj.<span class="property">b</span> = <span class="number">999</span> <span class="comment">// b无法被添加</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj) <span class="comment">// &#123;a: 6&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">isExtensible</span>(obj)) <span class="comment">// false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptor</span>(obj, <span class="string">&#x27;a&#x27;</span>)) </span><br><span class="line"><span class="comment">// &#123; value: 6, writable: true, enumerable: true, configurable: true &#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="密封特性"><a href="#密封特性" class="headerlink" title="密封特性"></a>密封特性</h2><p>密封对象是指那些 不可扩展 的，且所有自身属性都不可配置的（non-configurable）对象。</p>
<p>或则说 密封对象是指那些不能添加新的属性，不能删除已有属性，以及不能修改已有属性的可枚举性、可配置性、可写性，但可能可以修改已有属性的值的对象。</p>
<ul>
<li><p><code>Object.isSealed(obj)</code>: 判断一个对象是否是密封的（sealed）</p>
</li>
<li><p><code>Object.seal(obj)</code></p>
<ul>
<li>可以让一个对象密封，并返回被密封后的对象。</li>
</ul>
</li>
<li><p>通常情况下，一个对象是可扩展的（可以添加新的属性）。<br> 密封一个对象会让这个对象变的不能添加新属性，且所有已有属性会变的不可配置。<br> 属性不可配置的效果就是属性变的不可删除，以及一个数据属性不能被重新定义成为访问器属性，或者反之。</p>
<ul>
<li>但属性的值仍然可以修改。</li>
<li>尝试删除一个密封对象的属性或者将某个密封对象的属性从数据属性转换成访问器属性，结果在兼容模式下是静默失败，严格模式下会抛出 TypeError 异常。</li>
<li>不会影响从原型链上继承的属性。但 <strong>proto</strong> () 属性的值也会不能修改。</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> o = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">isSealed</span>(o)) <span class="comment">// false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">seal</span>(o)) <span class="comment">// &#123;a:1,b:2&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">isSealed</span>(o)) <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">delete</span> o.<span class="property">b</span>) <span class="comment">// false</span></span><br><span class="line">o.<span class="property">c</span> = <span class="number">3</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(o) <span class="comment">// &#123;a:1,b:2&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="冻结特性"><a href="#冻结特性" class="headerlink" title="冻结特性"></a>冻结特性</h2><p>一个对象是冻结的（frozen）是指它不可扩展，所有属性都是不可配置的（non-configurable），且所有数据属性（data properties）都是不可写的（non-writable）。</p>
<p>数据属性是值那些没有取值器（getter）或赋值器（setter）的属性。</p>
<p>或则说 冻结对象是指那些不能添加新的属性，不能修改已有属性的值，不能删除已有属性，以及不能修改已有属性的可枚举性、可配置性、可写性的对象。也就是说，这个对象永远是不可变的。</p>
<ul>
<li><code>Object.isFrozen(obj)</code>: 判断一个对象是否被冻结（frozen）</li>
<li><code>Object.freeze(obj)</code><ul>
<li>冻结对象是指那些不能添加新的属性，不能修改已有属性的值，不能删除已有属性，以及不能修改已有属性的可枚举性、可配置性、可写性的对象。也就是说，这个对象永远是不可变的。该方法返回被冻结的对象。</li>
<li>obj 将要被冻结的对象</li>
<li>冻结对象的所有自身属性都不可能以任何方式被修改。<br>任何尝试修改该对象的操作都会失败，可能是静默失败，也可能会抛出异常（严格模式中）。<br>数据属性的值不可更改，访问器属性（有getter和setter）也同样（但由于是函数调用，给人的错觉是还是可以修改这个属性）。<br>如果一个属性的值是个对象，则这个对象中的属性是可以修改的，除非它也是个冻结对象。</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> o = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">isFrozen</span>(o)) <span class="comment">// false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">freeze</span>(o)) <span class="comment">// &#123;a:1,b:2&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">isFrozen</span>(o)) <span class="comment">// true</span></span><br><span class="line">o.<span class="property">a</span> = <span class="number">3</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(o) <span class="comment">// &#123;a:1,b:2&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="浅冻结和深冻结"><a href="#浅冻结和深冻结" class="headerlink" title="浅冻结和深冻结"></a>浅冻结和深冻结</h3><p>倘若一个对象的属性是一个对象，那么对这个外部对象进行冻结，内部对象的属性是依旧可以改变的，这就叫浅冻结，若把外部对象冻结的同时把其所有内部对象甚至是内部的内部无限延伸的对象属性也冻结了，这就叫深冻结。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/01/31/js%E4%B8%AD%E5%B1%9E%E6%80%A7%E6%8F%8F%E8%BF%B0%E7%AC%A6%E4%B8%8E%E5%AF%B9%E8%B1%A1%E7%8A%B6%E6%80%81/" data-id="cldjpozur000598t47tq24e48" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-事件循环" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/01/31/%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF/" class="article-date">
  <time datetime="2023-01-31T03:21:58.000Z" itemprop="datePublished">2023-01-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/01/31/%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF/">事件循环</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="JS引擎"><a href="#JS引擎" class="headerlink" title="JS引擎"></a>JS引擎</h2><p><strong>本文不详细解释浏览器线程，只着重说明任务队列的执行</strong></p>
<p>JavaScript 是一门<strong>单线程语言</strong>，虽然在 html5 中提出了 Web-Worker ，但这并未改变 JavaScript 是单线程这一核心。</p>
<p>浏览器是多进程的，其中和前端关系最紧密的是浏览器渲染进程（也称浏览器内核），其中包括<strong>GUI 渲染线程（负责渲染页面，解析 HTML，CSS 构成 DOM 树）、JS 引擎线程、事件触发线程、定时器触发线程、http 请求线程等。</strong></p>
<p>在JS引擎中有一个main thread 主进程和call-stack（一个调用堆栈），在对一个调用堆栈中的task处理的时候，其他的都要等着。当在执行过程中遇到一些类似于setTimeout等异步操作的时候，会交给浏览器的其他模块(以webkit为例，是webcore模块)进行处理，当到达setTimeout指定的延时执行的时间之后，task(回调函数)会放入到任务队列之中。一般不同的异步任务的回调函数会放入不同的任务队列之中。等到调用栈中所有task执行完毕之后，接着去执行任务队列之中的task(回调函数)。</p>
<p>用Philip Roberts的演讲<a href="https://link.zhihu.com/?target=https://vimeo.com/96425312">《Help, I’m stuck in an event-loop》</a>之中的一张图表示就是 </p>
<p><img src="/2023/01/31/%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF/event-loop-01.jpg"></p>
<p>在上图中，调用栈中遇到<strong>DOM操作、ajax请求以及setTimeout等WebAPIs</strong>的时候就会交给浏览器内核的其他模块进行处理，webkit内核在Javasctipt执行引擎之外，有一个重要的模块是webcore模块。<br>对于图中WebAPIs提到的三种API，webcore分别提供了DOM Binding、network、timer模块来处理底层实现。等到这些模块处理完这些操作的时候将回调函数放入任务队列中，之后等栈中的task执行完之后再去执行任务队列之中的回调函数。</p>
<h2 id="任务队列"><a href="#任务队列" class="headerlink" title="任务队列"></a>任务队列</h2><p>HTML标准中对任务队列的解释：</p>
<ul>
<li>为了协调事件（event），用户交互（user interaction），脚本（script），渲染（rendering），网络（networking）等，用户代理（user agent）必须使用事件循环（event loops）。</li>
<li>有两类事件循环：一种针对浏览上下文（browsing context），还有一种针对worker（web worker）。</li>
</ul>
<p>在JavaScript中，任务被分为两种，一种叫任务（Tasks），一种叫微任务（MicroTask）。</p>
<p>其中任务（Tasks）也常被称为宏任务（MacroTask），实际上在MDN上是Tasks，详见<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTML_DOM_API/Microtask_guide#%E4%BB%BB%E5%8A%A1_vs_%E5%BE%AE%E4%BB%BB%E5%8A%A1">任务VS微任务</a>。</p>
<p>以下均用宏任务（MacroTask）指代任务（Tasks）。</p>
<h3 id="宏任务（MacroTask）"><a href="#宏任务（MacroTask）" class="headerlink" title="宏任务（MacroTask）"></a>宏任务（MacroTask）</h3><p>一个宏任务就是由执行诸如从头执行一段程序、执行一个事件回调或一个<code>interval/timeout</code>被触发之类的标准机制而被调度的任意 JavaScript 代码。这些都在 <strong>任务队列（task queue）</strong>上被调度。</p>
<p>在以下时机，任务会被添加到任务队列：</p>
<ul>
<li>一段新程序或子程序被直接执行时（比如从一个控制台，或在一个<code>&lt;script&gt;</code>元素中运行代码）。</li>
<li>触发了一个事件，将其回调函数添加到任务队列时。</li>
<li>执行到一个由<code>setTimeout()</code>或<code>setInterval()</code>创建的<code>timeout</code>或<code>interval</code>，以致相应的回调函数被添加到任务队列时。</li>
</ul>
<p>事件循环驱动你的代码按照这些任务排队的顺序，一个接一个地处理它们。在当前迭代轮次中，只有那些当事件循环过程开始时 已经处于任务队列中 的任务会被执行。其余的任务需要等待等待到下一次迭代。</p>
<p>常见的宏任务有：script全部代码、setTimeout、setInterval、setImmediate（浏览器暂时不支持，只有IE10支持，具体可见MDN）、I/O、UI Rendering。</p>
<h3 id="微任务（MicroTask）"><a href="#微任务（MicroTask）" class="headerlink" title="微任务（MicroTask）"></a>微任务（MicroTask）</h3><p>微任务就是一个简短的函数，当创建该函数的函数执行之后，并且只有当 Javascript调用栈为空，而控制权尚未返还给被 user agent 用来驱动脚本执行环境的事件循环之前，该微任务才会被执行。 </p>
<p>常见的微任务有：Process.nextTick（Node独有）、Promise、Object.observe(废弃)、MutationObserver。</p>
<p>为了允许第三方库、框架、polyfills 能使用微任务，Window 暴露了 <code>queueMicrotask()</code>方法，而 Worker 接口则通过<code>WindowOrWorkerGlobalScope mixin</code> 提供了同名的 <code>queueMicrotask()</code> 方法。</p>
<h2 id="执行栈执行顺序"><a href="#执行栈执行顺序" class="headerlink" title="执行栈执行顺序"></a>执行栈执行顺序</h2><h3 id="从setTimeout了解事件循环"><a href="#从setTimeout了解事件循环" class="headerlink" title="从setTimeout了解事件循环"></a>从setTimeout了解事件循环</h3><p>上面说过，setTimeout属于宏任务，现在我们有以下一段代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span></span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<p>JS引擎可以简化为三部分，stack(执行栈), webapis,task queen(任务队列)。</p>
<p>执行栈在执行完同步任务后，查看执行栈是否为空，如果执行栈为空，就会去检查微任务(microTask)队列是否为空，如果为空的话，就执行Task（宏任务），否则就一次性执行完所有微任务。<br>每次单个宏任务执行完毕后，检查微任务(microTask)队列是否为空，如果不为空的话，会按照先入先出的规则全部执行完微任务(microTask)后，设置微任务(microTask)队列为null，然后再执行宏任务，如此循环。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;A&#x27;</span>);</span><br><span class="line">        &#125;,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">var</span> obj=&#123;</span><br><span class="line">            <span class="attr">func</span>:<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;B&#x27;</span>)</span><br><span class="line">                &#125;,<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve</span>) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;C&#x27;</span>);</span><br><span class="line">                    <span class="title function_">resolve</span>();</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        obj.<span class="title function_">func</span>().<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;E&#x27;</span>);</span><br><span class="line"><span class="comment">//CEDAB</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/01/31/%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF/" data-id="cldjpozv0000q98t4eofycme7" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-js中的浅拷贝与深拷贝" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/01/31/js%E4%B8%AD%E7%9A%84%E6%B5%85%E6%8B%B7%E8%B4%9D%E4%B8%8E%E6%B7%B1%E6%8B%B7%E8%B4%9D/" class="article-date">
  <time datetime="2023-01-31T03:21:50.000Z" itemprop="datePublished">2023-01-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/01/31/js%E4%B8%AD%E7%9A%84%E6%B5%85%E6%8B%B7%E8%B4%9D%E4%B8%8E%E6%B7%B1%E6%8B%B7%E8%B4%9D/">js中的浅拷贝与深拷贝</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><p>数据分为基本数据类型(String, Number, Boolean, Null, Undefined，Symbol)和对象数据类型。</p>
<ol>
<li><p>基本数据类型的特点：直接存储在栈(stack)中的数据</p>
</li>
<li><p>引用数据类型的特点：<strong>存储的是该对象在栈中引用，真实的数据存放在堆内存里</strong></p>
</li>
</ol>
<p>引用数据类型在栈中存储了指针，该指针指向堆中该实体的起始地址。当解释器寻找引用值时，会首先检索其在栈中的地址，取得地址后从堆中获得实体。</p>
<h2 id="浅拷贝与深拷贝"><a href="#浅拷贝与深拷贝" class="headerlink" title="浅拷贝与深拷贝"></a>浅拷贝与深拷贝</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>浅拷贝：<strong>新的对象复制已有对象中非对象属性的值和对象属性的引用</strong>。也可以理解为：<strong>一个新的对象直接拷贝已存在的对象的对象属性的引用</strong>，即浅拷贝。</p>
<p>深拷贝： 复制变量值，对于引用数据，则递归至基本类型后，再复制。深拷贝后的对象<strong>与原来的对象完全隔离</strong>，互不影响，对一个对象的修改并不会影响另一个对象。</p>
<p><strong>深拷贝和浅拷贝是只针对Object和Array这样的引用数据类型的</strong>。</p>
<p>浅拷贝只对第一层属性进行了拷贝，当第一层的属性值是基本数据类型时，新的对象和原对象互不影响，但是如果第一层的属性值是复杂数据类型，那么新对象和原对象的属性值其指向的是同一块内存地址。具体到实际情况中当对象的属性值是引用类型时，实质复制的是其引用，当引用指向的值改变时也会跟着变化。</p>
<p>深拷贝复制变量值，对于非基本类型的变量，则递归至基本类型变量后，再复制。深拷贝后的对象与原来的对象是完全隔离的，互不影响，对一个对象的修改并不会影响另一个对象。</p>
<p>总而言之， <strong>浅拷贝只复制指向某个对象的指针，而不复制对象本身，新旧对象还是共享同一块内存。但深拷贝会另外创造一个一模一样的对象，新对象跟原对象不共享内存，修改新对象不会改到原对象。</strong></p>
<h2 id="浅拷贝的实现"><a href="#浅拷贝的实现" class="headerlink" title="浅拷贝的实现"></a>浅拷贝的实现</h2><h3 id="Object-assign"><a href="#Object-assign" class="headerlink" title="Object.assign()"></a>Object.assign()</h3><p><code>Object.assign()</code> 方法可以把任意多个的源对象自身的可枚举属性拷贝给目标对象，然后返回目标对象。但是 <code>Object.assign()</code> 进行的是浅拷贝，拷贝的是对象的属性的引用，而不是对象本身。</p>
<ul>
<li>只拷贝源对象的自身属性（不拷贝继承属性）；</li>
<li>不会拷贝对象不可枚举的属性；</li>
<li>属性名为<code>Symbol</code> 值的属性，可以被Object.assign拷贝；</li>
<li><code>undefined</code>和<code>null</code>无法转成对象，它们不能作为<code>Object.assign</code>参数，但是可以作为源对象。</li>
<li>当object只有一层的时候，是深拷贝</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> object1 = &#123;</span><br><span class="line">  <span class="attr">number</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">string</span>: <span class="string">&#x27;abc&#x27;</span>,</span><br><span class="line">  <span class="attr">array</span>: [<span class="number">0</span>, <span class="number">1</span>, &#123; <span class="attr">arrayObj</span>: <span class="number">0</span> &#125;],</span><br><span class="line">  <span class="attr">object</span>: &#123; <span class="attr">obj1</span>: <span class="number">1</span>, <span class="attr">obj2</span>: <span class="string">&#x27;2&#x27;</span>, <span class="attr">deep</span>: &#123; <span class="attr">obj1</span>: <span class="number">3</span> &#125; &#125;,</span><br><span class="line">  <span class="attr">reg</span>: <span class="regexp">/\d+/</span>,</span><br><span class="line">  <span class="attr">date</span>: <span class="keyword">new</span> <span class="title class_">Date</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> object2 = <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, object1)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(object1.<span class="property">number</span>, object2.<span class="property">number</span>) <span class="comment">// 2 1</span></span><br><span class="line"></span><br><span class="line">object1.<span class="property">array</span>[<span class="number">0</span>] = <span class="number">9</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(object1.<span class="property">array</span>, object2.<span class="property">array</span>, object3.<span class="property">array</span>)</span><br><span class="line"><span class="comment">// [ 9, 1, &#123; arrayObj: 0 &#125; ] [ 9, 1, &#123; arrayObj: 0 &#125; ] [ 0, 1, &#123; arrayObj: 0 &#125; ]</span></span><br></pre></td></tr></table></figure>

<h3 id="Array上的方法"><a href="#Array上的方法" class="headerlink" title="Array上的方法"></a>Array上的方法</h3><p><code>Array.prototype.concat()</code>和<code>Array.prototype.slice()</code>由于会返回新数组，可以利用它们实现数组的浅拷贝</p>
<h2 id="深拷贝实现"><a href="#深拷贝实现" class="headerlink" title="深拷贝实现"></a>深拷贝实现</h2><h3 id="JSON-parse-JSON-stringify-obj"><a href="#JSON-parse-JSON-stringify-obj" class="headerlink" title="JSON.parse(JSON.stringify(obj))"></a>JSON.parse(JSON.stringify(obj))</h3><p>原理： 用JSON.stringify将对象转成JSON字符串，再用JSON.parse()把字符串解析成对象，一去一来，新的对象产生了，而且对象会开辟新的栈，实现深拷贝。</p>
<ul>
<li>拷贝的对象的值中如果有函数， <code>undefined</code> ， <code>symbol</code> 则经过 <code>JSON.stringify()</code> `序列化后的JSON字符串中这个键值对会消失；</li>
<li>无法拷贝不可枚举的属性，无法拷贝对象的原型链；</li>
<li>拷贝 <code>Date</code> 引用类型会变成字符串；</li>
<li>拷贝 <code>RegExp</code> 引用类型会变成空对象；</li>
<li>对象中含有 <code>NaN</code> 、 <code>Infinity</code> 和 <code>-Infinity</code> ，则序列化的结果会变成 <code>null</code> ；</li>
<li>无法拷贝对象的循环应用(即 <code>obj[key] = obj</code> )。</li>
</ul>
<h3 id="手写递归方法"><a href="#手写递归方法" class="headerlink" title="手写递归方法"></a>手写递归方法</h3><ol>
<li><p>深拷贝最简单的实现是: <code>JSON.parse(JSON.stringify(obj))</code>，这是最简单的实现方式，但是有一些缺陷：</p>
<ul>
<li><p>对象的属性值是函数时，无法拷贝。</p>
</li>
<li><p>原型链上的属性无法拷贝。</p>
</li>
<li><p>不能正确的处理 <code>Date</code> 类型的数据。</p>
</li>
<li><p>不能处理 <code>RegExp</code>。</p>
</li>
<li><p>会忽略 <code>symbol</code>。</p>
</li>
<li><p>会忽略 <code>undefined</code>。</p>
</li>
</ul>
</li>
<li><p>实现一个 <code>deepClone</code> 函数</p>
<ul>
<li>如果是基本数据类型，直接返回。</li>
<li>如果是 <code>RegExp</code> 或者 <code>Date</code> 类型，返回对应类型。</li>
<li>如果是复杂数据类型，递归。</li>
<li>考虑循环引用的问题。</li>
</ul>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  * 简易版深拷贝</span></span><br><span class="line"><span class="comment">  * 对于复杂数据类型入Date和RegExp无法复制</span></span><br><span class="line"><span class="comment">  * 对于循环调用对象无法复制，甚至会报错</span></span><br><span class="line"><span class="comment">  * 循环调用举例:var a = &#123;&#125;;a.a = a</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isObj</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="keyword">typeof</span> obj === <span class="string">&#x27;object&#x27;</span> || <span class="keyword">typeof</span> obj === <span class="string">&#x27;function&#x27;</span>) &amp;&amp; obj !== <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">deepCopy</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> tempObj = <span class="title class_">Array</span>.<span class="title function_">isArray</span>(obj) ? [] : &#123;&#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">    tempObj[key] = <span class="title function_">isObj</span>(obj[key]) ? <span class="title function_">deepCopy</span>(obj[key]) : obj[key]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> tempObj</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 修正版深拷贝</span></span><br><span class="line"><span class="comment">* 采用weakmap和结构化深拷贝，前者解决循环调用对象问题，后者解决date，reg等类型的深拷贝</span></span><br><span class="line"><span class="comment">* WeakMap结构存储已经被拷贝的对象，每一次进行拷贝的时候就先向WeakMap查询该对象是否已经被拷贝，如果已经被拷贝则取出该对象并返回</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">deepClone</span>(<span class="params">obj, hash = <span class="keyword">new</span> <span class="built_in">WeakMap</span>()</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (obj === <span class="literal">null</span> || <span class="keyword">typeof</span> obj !== <span class="string">&#x27;object&#x27;</span>) <span class="keyword">return</span> obj</span><br><span class="line">  <span class="keyword">let</span> cloneObj</span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Constructor</span> = obj.<span class="property">constructor</span></span><br><span class="line">  <span class="keyword">switch</span> (<span class="title class_">Constructor</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="title class_">RegExp</span>:</span><br><span class="line">      cloneObj = <span class="keyword">new</span> <span class="title class_">Constructor</span>(obj)</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="title class_">Date</span>:</span><br><span class="line">      cloneObj = <span class="keyword">new</span> <span class="title class_">Constructor</span>(obj.<span class="title function_">getTime</span>())</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="comment">// 通过WeakMap去重，保证不重复引用</span></span><br><span class="line">      <span class="keyword">if</span> (hash.<span class="title function_">has</span>(obj)) <span class="keyword">return</span> hash.<span class="title function_">get</span>(obj)</span><br><span class="line">      cloneObj = <span class="keyword">new</span> <span class="title class_">Constructor</span>()</span><br><span class="line">      hash.<span class="title function_">set</span>(obj, cloneObj)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">    cloneObj[key] = <span class="title function_">isObj</span>(obj[key]) ? <span class="title function_">deepClone</span>(obj[key], hash) : obj[key]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> cloneObj</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> object1 = &#123;</span><br><span class="line">  <span class="attr">number</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">string</span>: <span class="string">&#x27;abc&#x27;</span>,</span><br><span class="line">  <span class="attr">array</span>: [<span class="number">0</span>, <span class="number">1</span>, &#123; <span class="attr">arrayObj</span>: <span class="number">0</span> &#125;],</span><br><span class="line">  <span class="attr">object</span>: &#123; <span class="attr">obj1</span>: <span class="number">1</span>, <span class="attr">obj2</span>: <span class="string">&#x27;2&#x27;</span>, <span class="attr">deep</span>: &#123; <span class="attr">obj1</span>: <span class="number">3</span> &#125; &#125;,</span><br><span class="line">  <span class="attr">reg</span>: <span class="regexp">/\d+/</span>,</span><br><span class="line">  <span class="attr">date</span>: <span class="keyword">new</span> <span class="title class_">Date</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// object1.a = object1 // 循环引用</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> object2 = &#123; ...object1 &#125;</span><br><span class="line"><span class="keyword">const</span> object3 = <span class="title function_">deepCopy</span>(object1)</span><br><span class="line"><span class="keyword">const</span> object4 = <span class="title function_">deepClone</span>(object1)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 改变数字</span></span><br><span class="line">object1.<span class="property">number</span> = <span class="number">2</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;改变数字&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;原对象&#x27;</span>, object1.<span class="property">number</span>, <span class="string">&#x27;解构赋值(Object.assign)&#x27;</span>, object2.<span class="property">number</span>, <span class="string">&#x27;深拷贝(简易)&#x27;</span>, object3.<span class="property">number</span>, <span class="string">&#x27;深拷贝(基本完全)&#x27;</span>, object4.<span class="property">number</span>)</span><br><span class="line"><span class="comment">// 原对象 2 解构赋值(Object.assign) 1 深拷贝(简易) 1 深拷贝(基本完全) 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 改变字符</span></span><br><span class="line">object1.<span class="property">string</span> = <span class="string">&#x27;def&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;改变字符串&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;原对象&#x27;</span>, object1.<span class="property">string</span>, <span class="string">&#x27;解构赋值(Object.assign)&#x27;</span>, object2.<span class="property">string</span>, <span class="string">&#x27;深拷贝(简易)&#x27;</span>, object3.<span class="property">string</span>, <span class="string">&#x27;深拷贝(基本完全)&#x27;</span>, object4.<span class="property">string</span>)</span><br><span class="line"><span class="comment">// 原对象 def 解构赋值(Object.assign) abc 深拷贝(简易) abc 深拷贝(基本完全) abc</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 改变数组元素</span></span><br><span class="line">object1.<span class="property">array</span>[<span class="number">0</span>] = <span class="number">9</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;改变数组元素（非对象）&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;原对象&#x27;</span>, object1.<span class="property">array</span>[<span class="number">0</span>], <span class="string">&#x27;解构赋值(Object.assign)&#x27;</span>, object2.<span class="property">array</span>[<span class="number">0</span>], <span class="string">&#x27;深拷贝(简易)&#x27;</span>, object3.<span class="property">array</span>[<span class="number">0</span>], <span class="string">&#x27;深拷贝(基本完全)&#x27;</span>, object4.<span class="property">array</span>[<span class="number">0</span>])</span><br><span class="line"><span class="comment">// 原对象 9 解构赋值(Object.assign) 9 深拷贝(简易) 0 深拷贝(基本完全) 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 改变数组元素</span></span><br><span class="line">object1.<span class="property">array</span>[<span class="number">2</span>].<span class="property">arrayObj</span> = <span class="number">9</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;改变数组元素（对象）&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">  <span class="string">&#x27;原对象&#x27;</span>, object1.<span class="property">array</span>[<span class="number">2</span>].<span class="property">arrayObj</span>,</span><br><span class="line">  <span class="string">&#x27;解构赋值(Object.assign)&#x27;</span>, object2.<span class="property">array</span>[<span class="number">2</span>].<span class="property">arrayObj</span>,</span><br><span class="line">  <span class="string">&#x27;深拷贝(简易)&#x27;</span>, object3.<span class="property">array</span>[<span class="number">2</span>].<span class="property">arrayObj</span>,</span><br><span class="line">  <span class="string">&#x27;深拷贝(基本完全)&#x27;</span>, object4.<span class="property">array</span>[<span class="number">2</span>].<span class="property">arrayObj</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// 原对象 9 解构赋值(Object.assign) 9 深拷贝(简易) 0 深拷贝(基本完全) 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 改变对象</span></span><br><span class="line">object1.<span class="property">object</span>.<span class="property">obj1</span> = <span class="number">9</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;改变对象中的属性（一层）&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;原对象&#x27;</span>, object1.<span class="property">object</span>.<span class="property">obj1</span>, <span class="string">&#x27;解构赋值(Object.assign)&#x27;</span>, object2.<span class="property">object</span>.<span class="property">obj1</span>, <span class="string">&#x27;深拷贝(简易)&#x27;</span>, object3.<span class="property">object</span>.<span class="property">obj1</span>, <span class="string">&#x27;深拷贝(基本完全)&#x27;</span>, object4.<span class="property">object</span>.<span class="property">obj1</span>)</span><br><span class="line"><span class="comment">// 原对象 9 解构赋值(Object.assign) 9 深拷贝(简易) 1 深拷贝(基本完全) 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 改变对象</span></span><br><span class="line">object1.<span class="property">object</span>.<span class="property">deep</span>.<span class="property">obj1</span> = <span class="number">9</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;改变对象中的属性（二层）&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">  <span class="string">&#x27;原对象&#x27;</span>, object1.<span class="property">object</span>.<span class="property">deep</span>.<span class="property">obj1</span>,</span><br><span class="line">  <span class="string">&#x27;解构赋值(Object.assign)&#x27;</span>, object2.<span class="property">object</span>.<span class="property">deep</span>.<span class="property">obj1</span>,</span><br><span class="line">  <span class="string">&#x27;深拷贝(简易)&#x27;</span>, object3.<span class="property">object</span>.<span class="property">deep</span>.<span class="property">obj1</span>,</span><br><span class="line">  <span class="string">&#x27;深拷贝(基本完全)&#x27;</span>, object4.<span class="property">object</span>.<span class="property">deep</span>.<span class="property">obj1</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// 原对象 9 解构赋值(Object.assign) 9 深拷贝(简易) 3 深拷贝(基本完全) 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 改变对象</span></span><br><span class="line">object1.<span class="property">reg</span> = <span class="regexp">/\d*/</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;改变正则&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">  <span class="string">&#x27;原对象&#x27;</span>, object1.<span class="property">reg</span>,</span><br><span class="line">  <span class="string">&#x27;解构赋值(Object.assign)&#x27;</span>, object2.<span class="property">reg</span>,</span><br><span class="line">  <span class="string">&#x27;深拷贝(简易)&#x27;</span>, object3.<span class="property">reg</span>,</span><br><span class="line">  <span class="string">&#x27;深拷贝(基本完全)&#x27;</span>, object4.<span class="property">reg</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// 原对象 /\d*/ 解构赋值(Object.assign) /\d+/ 深拷贝(简易) &#123;&#125; 深拷贝(基本完全) /\d+/</span></span><br><span class="line"><span class="comment">// 改变对象</span></span><br><span class="line">object1.<span class="property">date</span> = <span class="keyword">new</span> <span class="title class_">Date</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;改变日期&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">  <span class="string">&#x27;原对象&#x27;</span>, object1.<span class="property">date</span>,</span><br><span class="line">  <span class="string">&#x27;解构赋值(Object.assign)&#x27;</span>, object2.<span class="property">date</span>,</span><br><span class="line">  <span class="string">&#x27;深拷贝(简易)&#x27;</span>, object3.<span class="property">date</span>,</span><br><span class="line">  <span class="string">&#x27;深拷贝(基本完全)&#x27;</span>, object4.<span class="property">date</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// 原对象 2020-08-06T08:41:29.199Z 解构赋值(Object.assign) 2020-08-06T08:41:29.187Z 深拷贝(简易) &#123;&#125; 深拷贝(基本完全) 2020-08-06T08:41:29.187Z</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/01/31/js%E4%B8%AD%E7%9A%84%E6%B5%85%E6%8B%B7%E8%B4%9D%E4%B8%8E%E6%B7%B1%E6%8B%B7%E8%B4%9D/" data-id="cldjpozus000798t4hyms4e6c" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-鉴权和在node上的实现" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/01/31/%E9%89%B4%E6%9D%83%E5%92%8C%E5%9C%A8node%E4%B8%8A%E7%9A%84%E5%AE%9E%E7%8E%B0/" class="article-date">
  <time datetime="2023-01-31T03:21:36.000Z" itemprop="datePublished">2023-01-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/01/31/%E9%89%B4%E6%9D%83%E5%92%8C%E5%9C%A8node%E4%B8%8A%E7%9A%84%E5%AE%9E%E7%8E%B0/">鉴权和在node上的实现</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="鉴权"><a href="#鉴权" class="headerlink" title="鉴权"></a>鉴权</h1><p>目前常见的鉴权方式有4种</p>
<ul>
<li>session-cookie</li>
<li>token(jwt)</li>
<li>OAuth(开放授权)</li>
<li>SSO</li>
</ul>
<h2 id="session-cookie"><a href="#session-cookie" class="headerlink" title="session-cookie"></a>session-cookie</h2><p>session会话机制是⼀种服务器端机制，它使⽤类似于哈希表（可能还有哈希表）的结构来保存信<br>息。</p>
<h3 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h3><ol>
<li>服务器在接受客户端⾸次访问时在服务器端创建seesion，然后保存seesion(我们可以将seesion保存在内存中，也可以保存在redis中，推荐使⽤后者)，然后给这个session⽣成⼀个唯⼀的标识字符串,然后在响应头中种下这个唯⼀标识字符串。</li>
<li>签名。这⼀步通过秘钥对sid进⾏签名处理，避免客户端修改sid。（⾮必需步骤）</li>
<li>浏览器中收到请求响应的时候会解析响应头，然后将sid保存在本地cookie中，浏览器在下次http请求的请求头中会带上该域名下的cookie信息，</li>
<li>服务器在接受客户端请求时会去解析请求头cookie中的sid，然后根据这个sid去找服务器端<br>保存的该客户端的session，然后判断该请求是否合法。</li>
</ol>
<h3 id="数字签名"><a href="#数字签名" class="headerlink" title="数字签名"></a>数字签名</h3><p>数字签名（又称公钥数字签名）是只有信息的发送者才能产生的别人无法伪造的一段数字串，这段数字串同时也是对信息的发送者发送信息真实性的一个有效证明。</p>
<h3 id="kos中使用session"><a href="#kos中使用session" class="headerlink" title="kos中使用session"></a>kos中使用session</h3><p>在kos中使用koa-session中间件 <code>yarn add koa-session</code></p>
<p>koa-session本身并没有维护一个session对象在应用中，而是抽象出了一个session中间件模型，并且定义了需要子类实现的抽象接口Store，可以很方便的支持外部store的扩展。同时默认内置了基于cookie的存储方案。</p>
<ul>
<li><p>内部存储</p>
<p>在未使用外部存储时，koa-session不会维护一个session对象，而是将每个session的值通过base64编码(也可以传入自定义的encode/decode方法)后放到了cookie中，在每次请求到来时，再从该请求的cookie中取出数据挂到ctx.session上。解密后参考如下<code>&#123;&quot;count&quot;:4,&quot;_expire&quot;:1637054244142,&quot;_maxAge&quot;:86400000&#125;</code></p>
</li>
<li><p>外部存储方案</p>
<p> koa-session支持了一个使用外部的Store，这里通常建议使用redis(后面有)</p>
</li>
</ul>
<p>因此通常需要配置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> koa = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> <span class="title function_">koa</span>()</span><br><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">&#x27;koa-session&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> port = <span class="number">3000</span></span><br><span class="line">app.<span class="property">keys</span> = [<span class="string">&#x27;this is secret&#x27;</span>] <span class="comment">// 密钥 签名时用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置项</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">SESS_CONFIG</span> = &#123;</span><br><span class="line">  <span class="attr">key</span>: <span class="string">&#x27;koa:sess&#x27;</span>, <span class="comment">// cookie的key。 (默认是 koa:sess) </span></span><br><span class="line">  <span class="attr">maxAge</span>: <span class="number">4000</span>, <span class="comment">// session 过期时间，以毫秒ms为单位计算 。</span></span><br><span class="line">  <span class="attr">autoCommit</span>: <span class="literal">true</span>, <span class="comment">// 自动提交到响应头。(默认是 true) </span></span><br><span class="line">  <span class="attr">overwrite</span>: <span class="literal">true</span>, <span class="comment">// 是否允许重写 。(默认是 true) </span></span><br><span class="line">  <span class="attr">httpOnly</span>: <span class="literal">true</span>, <span class="comment">// 是否设置HttpOnly，如果在Cookie中设置了&quot;HttpOnly&quot;属性，那么通过程序(JS脚本、Applet等)将无法读取到Cookie信息，这样能有效的防止XSS攻击。  (默认 true) </span></span><br><span class="line">  <span class="attr">signed</span>: <span class="literal">true</span>, <span class="comment">// 是否签名。(默认是 true) </span></span><br><span class="line">  <span class="attr">rolling</span>: <span class="literal">true</span>, <span class="comment">// 是否每次响应时刷新Session的有效期。(默认是 false) </span></span><br><span class="line">  <span class="attr">renew</span>: <span class="literal">false</span>,  <span class="comment">// 是否在Session快过期时刷新Session的有效期。(默认是 false) </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">session</span>(<span class="variable constant_">SESS_CONFIG</span>, app))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">ctx</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (ctx.<span class="property">path</span> === <span class="string">&#x27;/favicon.ico&#x27;</span>) &#123;</span><br><span class="line">    ctx.<span class="property">body</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 获取</span></span><br><span class="line">  <span class="keyword">let</span> n = ctx.<span class="property">session</span>.<span class="property">count</span> || <span class="number">0</span></span><br><span class="line">  <span class="comment">// 设置</span></span><br><span class="line">  ctx.<span class="property">session</span>.<span class="property">count</span> = n + <span class="number">1</span></span><br><span class="line">  ctx.<span class="property">body</span> = <span class="string">&#x27;第&#x27;</span> + n + <span class="string">&#x27;次访问&#x27;</span></span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(port, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;start on &#x27;</span> + port)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/01/31/%E9%89%B4%E6%9D%83%E5%92%8C%E5%9C%A8node%E4%B8%8A%E7%9A%84%E5%AE%9E%E7%8E%B0/" data-id="cldjpozv2000x98t4auii3tul" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-垃圾回收机制（GC）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/01/31/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6%EF%BC%88GC%EF%BC%89/" class="article-date">
  <time datetime="2023-01-31T03:20:57.000Z" itemprop="datePublished">2023-01-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/01/31/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6%EF%BC%88GC%EF%BC%89/">垃圾回收机制（GC）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="垃圾回收机制（GC）"><a href="#垃圾回收机制（GC）" class="headerlink" title="垃圾回收机制（GC）"></a>垃圾回收机制（GC）</h1><p>垃圾回收（Garbage Collection，缩写为GC）是一种自动的存储器管理机制。当某个程序占用的一部分内存空间不再被这个程序访问时，这个程序会借助垃圾回收算法向操作系统归还这部分内存空间。垃圾回收器可以减轻程序员的负担，也减少程序中的错误。垃圾回收最早起源于LISP语言。目前许多语言如Smalltalk、Java、C#和D语言都支持垃圾回收器，我们熟知的 JavaScript 具有自动垃圾回收机制。 </p>
<p>垃圾回收语言通过<strong>周期性地检查先前分配的内存是否可达</strong>，帮助开发者管理内存。换言之，垃圾回收语言减轻了“内存仍可用”及“内存仍可达”的问题。两者的区别是微妙而重要的：仅有开发者了解哪些内存在将来仍会使用，而不可达内存通过算法确定和标记，适时被操作系统回收。</p>
<p> <strong>在 JavaScript 中，原始类型的数据被分配到栈空间中，引用类型的数据会被分配到堆空间中。</strong> </p>
<h2 id="栈空间中的垃圾回收"><a href="#栈空间中的垃圾回收" class="headerlink" title="栈空间中的垃圾回收"></a>栈空间中的垃圾回收</h2><p>当函数 <code>showName</code> 调用完成后，通过下移 ESP（Extended Stack Pointer）指针，来销毁 <code>showName</code> 函数，之后调用其他函数时，将覆盖掉旧内存，存放另一个函数的执行上下文，实现垃圾回收。 </p>
<h2 id="堆空间中的垃圾回收"><a href="#堆空间中的垃圾回收" class="headerlink" title="堆空间中的垃圾回收"></a><strong>堆空间中的垃圾回收</strong></h2><p>堆中数据垃圾回收策略的基础是：<strong>代际假说」</strong>（The Generational Hypothesis）。即：</p>
<ol>
<li>大部分对象在内存中存在时间极短，很多对象很快就不可访问。</li>
<li>不死的对象将活得更久。</li>
</ol>
<p>这两个特点不仅仅适用于 JavaScript，同样适用于大多数的动态语言，如 Java、Python 等。V8 引擎将堆空间分为<strong>新生代」</strong>（存放生存<strong>时间短」</strong>的对象）和<strong>老生代」</strong>（存放生存<strong>时间长」</strong>的对象）两个区域，并使用不同的垃圾回收器。</p>
<ul>
<li>副垃圾回收器，主要负责新生代的垃圾回收。</li>
<li>主垃圾回收器，主要负责老生代的垃圾回收。</li>
</ul>
<p>不管是哪种垃圾回收器，都使用相同垃圾回收流程：<strong>标记活动对象和非活动对象，回收非活动对象的内存，最后内存整理。」</strong></p>
<h3 id="副垃圾回收器"><a href="#副垃圾回收器" class="headerlink" title="副垃圾回收器"></a>副垃圾回收器</h3><p>使用 Scavenge 算法处理，将新生代空间对半分为两个区域，一个对象区域，一个空闲区域。</p>
<p>执行流程：</p>
<ul>
<li>新对象存在在<strong>对象区域」</strong>，当对象区域将要写满时，执行一次垃圾回收；</li>
<li>垃圾回收过程中，首先对对象区域中的垃圾做标记，然后副垃圾回收器将存活的对象复制并有序排列到空闲区域，相当于完成内存整理。</li>
<li>复制完成后，将对象区域和空闲区域翻转，完成垃圾回收操作，这也让新生代中两块区域无限重复使用。</li>
</ul>
<p>当然，这也存在一些问题：若复制操作的数据较大则影响清理效率。JavaScript 引擎的解决方式是：将新生代区域设置得比较小，并采用对象晋升策略（经过两次回收仍存活的对象，会被移动到老生区），避免因为新生代区域较小引起存活对象装满整个区域的问题。</p>
<h3 id="主垃圾回收器"><a href="#主垃圾回收器" class="headerlink" title="主垃圾回收器"></a>主垃圾回收器</h3><p>分为：<strong>标记 - 清除（Mark-Sweep）算法</strong>，和<strong>标记 - 整理（Mark-Compact）算法</strong>。</p>
<p>首先是mutator和collector，这两个名词经常在垃圾收集算法中出现，collector指的就是垃圾收集器，而mutator是指除了垃圾收集器之外的部分，比如说我们应用程序本身。mutator的职责一般是NEW(分配内存),READ(从内存中读取内容),WRITE(将内容写入内存)，而collector则就是回收不再使用的内存来供mutator进行NEW操作的使用。</p>
<p>第二个基本概念是关于mutator roots(mutator根对象),mutator根对象一般指的是分配在堆内存之外，可以直接被mutator直接访问到的对象，一般是指静态/全局变量以及Thread-Local变量(在Java中，存储在<code>java.lang.ThreadLocal</code>中的变量和分配在栈上的变量 - 方法内部的临时变量等都属于此类).</p>
<p>第三个基本概念是关于可达对象的定义，从mutator根对象开始进行遍历，可以被访问到的对象都称为是可达对象。这些对象也是mutator(你的应用程序)正在使用的对象。</p>
<p>标记 - 清除（Mark-Sweep）算法过程：</p>
<ul>
<li>在标记阶段，collector从mutator根对象开始进行遍历，对从mutator根对象可以访问到的对象都打上一个标识，一般是在对象的header中，将其记录为可达对象 </li>
<li>而在清除阶段，collector对堆内存(heap memory)从头到尾进行线性的遍历，如果发现某个对象没有标记为可达对象-通过读取对象的header信息，则就将其回收。 </li>
</ul>
<p>标记 - 整理（Mark-Compact）算法过程：</p>
<ul>
<li>标记过程：在标记阶段，collector从mutator根对象开始进行遍历，对从mutator根对象可以访问到的对象都打上一个标识，一般是在对象的header中，将其记录为可达对象 </li>
<li>整理过程：将所有存活的对象，向一段移动，然后清除端边界以外的内容。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/01/31/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6%EF%BC%88GC%EF%BC%89/" data-id="cldjpozv1000v98t43euc7io9" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/" rel="tag">浏览器</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-跨域" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/01/31/%E8%B7%A8%E5%9F%9F/" class="article-date">
  <time datetime="2023-01-31T03:20:44.000Z" itemprop="datePublished">2023-01-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/01/31/%E8%B7%A8%E5%9F%9F/">跨域</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="什么是跨域"><a href="#什么是跨域" class="headerlink" title="什么是跨域"></a>什么是跨域</h1><p>出于浏览器的同源策略限制。</p>
<h1 id="同源策略"><a href="#同源策略" class="headerlink" title="同源策略"></a>同源策略</h1><p>同源策略(Sameoriginpolicy)是一种约定，它是浏览器最核心也最基本的安全功能，如果缺少了同源策略，则浏览器的正常功能可能都会受到影响。</p>
<p>可以说Web是构建在同源策略基础之上的，<strong>浏览器只是针对同源策略的一种实现。</strong></p>
<p>同源策略会阻止一个域的javascript脚本和另外一个域的内容进行交互。所谓同源(即指在同一个域)就是两个页面具有相同的协议(protocol)，主机(host)和端口号(port)</p>
<h1 id="什么情况下会跨域"><a href="#什么情况下会跨域" class="headerlink" title="什么情况下会跨域"></a>什么情况下会跨域</h1><p> 当一个请求url的<strong>协议、域名、端口</strong>三者之间任意一个与当前页面url不同即为跨域 </p>
<table>
<thead>
<tr>
<th>当前页面url</th>
<th>请求url</th>
<th>是否跨域</th>
<th>原因</th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="http://www.test.com/">http://www.test.com/</a></td>
<td><a target="_blank" rel="noopener" href="http://www.test.com/index.html">http://www.test.com/index.html</a></td>
<td>否</td>
<td>同源（协议、域名、端口号相同）</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="http://www.test.com/">http://www.test.com/</a></td>
<td><a target="_blank" rel="noopener" href="https://www.test.com/index.html">https://www.test.com/index.html</a></td>
<td>跨域</td>
<td>协议不同（http/https）</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="http://www.test.com/">http://www.test.com/</a></td>
<td><a target="_blank" rel="noopener" href="http://www.baidu.com/">http://www.baidu.com/</a></td>
<td>跨域</td>
<td>主域名不同（test/baidu）</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="http://www.test.com/">http://www.test.com/</a></td>
<td><a target="_blank" rel="noopener" href="http://blog.test.com/">http://blog.test.com/</a></td>
<td>跨域</td>
<td>子域名不同（www/blog）</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="http://www.test.com:8080/">http://www.test.com:8080/</a></td>
<td><a target="_blank" rel="noopener" href="http://www.test.com:7001/">http://www.test.com:7001/</a></td>
<td>跨域</td>
<td>端口号不同（8080/7001）</td>
</tr>
</tbody></table>
<h1 id="同源策略限制的对象"><a href="#同源策略限制的对象" class="headerlink" title="同源策略限制的对象"></a>同源策略限制的对象</h1><ol>
<li>无法读取非同源网页的 Cookie、LocalStorage 和 IndexedDB </li>
<li>无法接触非同源网页的 DOM </li>
<li>无法向非同源地址发送 AJAX 请求</li>
</ol>
<h1 id="跨域的解决方法"><a href="#跨域的解决方法" class="headerlink" title="跨域的解决方法"></a>跨域的解决方法</h1><h2 id="JSONP"><a href="#JSONP" class="headerlink" title="JSONP"></a>JSONP</h2><ul>
<li>JSONP 是服务器与客户端跨源通信的常用方法</li>
<li>最大特点就是简单适用，兼容性好(兼容低版本IE)</li>
<li>缺点是只支持get请求，不支持post请求</li>
<li>核心思想：网页通过添加一个<code>&lt;script&gt;元素</code>，向服务器请求 JSON 数据，服务器收到请求后，将数据放在一个指定名字的回调函数的参数位置传回来</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * JSONP请求工具</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> url 请求的地址</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> data 请求的参数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> &#123;<span class="type">Promise&lt;any&gt;</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">request</span> = (<span class="params">&#123;url, data&#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 处理传参成xx=yy&amp;aa=bb的形式</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handleData</span> = (<span class="params">data</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> keys = <span class="title class_">Object</span>.<span class="title function_">keys</span>(data)</span><br><span class="line">      <span class="keyword">const</span> keysLen = keys.<span class="property">length</span></span><br><span class="line">      <span class="keyword">return</span> keys.<span class="title function_">reduce</span>(<span class="function">(<span class="params">pre, cur, index</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> value = data[cur]</span><br><span class="line">        <span class="keyword">const</span> flag = index !== keysLen - <span class="number">1</span> ? <span class="string">&#x27;&amp;&#x27;</span> : <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;pre&#125;</span><span class="subst">$&#123;cur&#125;</span>=<span class="subst">$&#123;value&#125;</span><span class="subst">$&#123;flag&#125;</span>`</span></span><br><span class="line">      &#125;, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 动态创建script标签</span></span><br><span class="line">    <span class="keyword">const</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>)</span><br><span class="line">    <span class="comment">// 接口返回的数据获取</span></span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">jsonpCb</span> = <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">removeChild</span>(script)</span><br><span class="line">      <span class="keyword">delete</span> <span class="variable language_">window</span>.<span class="property">jsonpCb</span></span><br><span class="line">      <span class="title function_">resolve</span>(res)</span><br><span class="line">    &#125;</span><br><span class="line">    script.<span class="property">src</span> = <span class="string">`<span class="subst">$&#123;url&#125;</span>?<span class="subst">$&#123;handleData(data)&#125;</span>&amp;cb=jsonpCb`</span></span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(script)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 使用方式</span></span><br><span class="line"><span class="title function_">request</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;http://localhost:9871/api/jsonp&#x27;</span>,</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="comment">// 传参</span></span><br><span class="line">    <span class="attr">msg</span>: <span class="string">&#x27;helloJsonp&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="空iframe加form"><a href="#空iframe加form" class="headerlink" title="空iframe加form"></a>空iframe加form</h2><ul>
<li>虽然JSONP兼容性小实现简单，但是它只适用于get方法</li>
<li>如果需要使用post请求资源的话需要用空iframe加form</li>
<li>核心思想：创建一个空iframe，包裹着form，通过form使用post方法请求资源，由于是iframe包裹着，因此不会发生跳转，得到资源之后前端就可以随意使用了</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">requestPost</span> = (<span class="params">&#123;url, data&#125;</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 首先创建一个用来发送数据的iframe.</span></span><br><span class="line">    <span class="keyword">const</span> iframe = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;iframe&#x27;</span>);</span><br><span class="line">    iframe.<span class="property">name</span> = <span class="string">&#x27;iframePost&#x27;</span>;</span><br><span class="line">    iframe.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(iframe);</span><br><span class="line">    <span class="keyword">const</span> form = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;form&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> node = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;input&#x27;</span>);</span><br><span class="line">    <span class="comment">// 注册iframe的load事件处理程序,如果你需要在响应返回时执行一些操作的话.</span></span><br><span class="line">    iframe.<span class="title function_">addEventListener</span>(<span class="string">&#x27;load&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;post success&#x27;</span>)</span><br><span class="line">    &#125;);</span><br><span class="line">    form.<span class="property">action</span> = url;</span><br><span class="line">    <span class="comment">// 在指定的iframe中执行form</span></span><br><span class="line">    form.<span class="property">target</span> = iframe.<span class="property">name</span>;</span><br><span class="line">    form.<span class="property">method</span> = <span class="string">&#x27;post&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> name <span class="keyword">in</span> data) &#123;</span><br><span class="line">        node.<span class="property">name</span> = name;</span><br><span class="line">        node.<span class="property">value</span> = data[name].<span class="title function_">toString</span>();</span><br><span class="line">        form.<span class="title function_">appendChild</span>(node.<span class="title function_">cloneNode</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 表单元素需要添加到主文档中.</span></span><br><span class="line">    form.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(form);</span><br><span class="line">    form.<span class="title function_">submit</span>();</span><br><span class="line">    <span class="comment">// 表单提交后,就可以删除这个表单,不影响下次的数据发送.</span></span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">removeChild</span>(form)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 使用方式</span></span><br><span class="line"><span class="title function_">requestPost</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;http://localhost:9871/api/iframePost&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">&#x27;helloIframePost&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="document-domain"><a href="#document-domain" class="headerlink" title="document.domain"></a>document.domain</h2><p>默认情况下，<code>document.domain</code>存放的是载入文档的服务器的主机名，可以手动设置这个属性，不过是有限制的，只能设置成当前域名或者上级的域名，并且必须要包含一个.号，也就是说不能直接设置成顶级域名。例如：<code>id.qq.com</code>，可以设置成<code>qq.com</code>，但是不能设置成com。</p>
<p>具有相同<code>document.domain</code>的页面，就相当于是处在同域名的服务器上，如果协议和端口号也是一致，那它们之间就可以跨域访问数据。</p>
<h2 id="window-postMessage"><a href="#window-postMessage" class="headerlink" title="window.postMessage"></a>window.postMessage</h2><p><code>window.postMessages</code>是<code>html5</code>中实现跨域访问的一种新方式，可以使用它来向其它的window对象发送消息，无论这个window对象是属于同源或不同源。 </p>
<h2 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h2><ul>
<li>CORS 是跨域资源分享(<code>Cross-Origin Resource Sharing</code>)的缩写。它是 W3C 标准，属于跨源 AJAX 请求的根本解决方法。</li>
<li>CORS背后的基本思想，就是使用自定义的HTTP头部让浏览器与服务器进行沟通，从而决定请求或响应是应该成功还是应该失败。</li>
<li>前端只需要检查浏览器是否能使用CORS，以及兼容处理(IE需要创建<code>XDomainRequest</code>对象)；主要是后端处理，设置<code>Access-Control-Allow-Origin:*</code></li>
</ul>
<p>其中<code>Access-Control-Allow-Origin</code>(访问控制之允许的源),在响应的<code>http header</code>中必须有的，表示允许访问本服务器的源头Origin(域名)，可以是特定的域名列表，用逗号分隔，也可以是通配符 *，表示支持任意域名的访问。<br>除了限定源头Origin，还会限制请求的方法Method，Header。<br>如，如果服务器设定<code>Access-Control-Allow-Methods:GET</code>，那么跨域的POST请求无法在这个服务器执行。</p>
<ul>
<li><code>Access-Control-Allow-Origin</code>：允许跨域的Origin列表</li>
<li><code>Access-Control-Allow-Methods</code>：允许跨域的方法列表</li>
<li><code>Access-Control-Allow-Headers</code>：允许跨域的Header列表</li>
<li><code>Access-Control-Expose-Headers</code>：允许暴露给JavaScript代码的Header列表</li>
<li><code>Access-Control-Max-Age</code>：最大的浏览器缓存时间，单位为s</li>
</ul>
<h1 id="CORS流程"><a href="#CORS流程" class="headerlink" title="CORS流程"></a>CORS流程</h1><p> <strong>跨域限制是浏览器行为，不是服务器行为。</strong> </p>
<ol>
<li>页面发送请求</li>
<li>浏览器根据同源策略做出判定，如果是同源请求，直接发送出去；<strong>如果是跨域请求，在HTTP HEADER加上Origin字段，或是先发送一次预检请求(preflight)(非简单请求时)。</strong></li>
<li>服务器接收请求，根据自身跨域的配置(如允许哪些域名，什么样的Method访问)，返回文件头。若未配置过任何允许跨域，则文件头里不包含<code>Access-Control-Allow-origin</code>字段，若配置过域名，则返回<code>Access-Control-Allow-origin+ 对应配置规则里的域名的方式</code>。</li>
<li>浏览器接收到响应，根据响应头里的<code>Access-Control-Allow-origin</code>字段做匹配，如果没有这个字段或者字段不匹配则浏览器报错跨域，并且不呈递信息(但是实际上浏览器有接收到后端返回的数据)。如果匹配的时候则能获得数据(简单请求)或继续发送请求(非简单请求)。</li>
</ol>
<h1 id="简单请求与预检请求"><a href="#简单请求与预检请求" class="headerlink" title="简单请求与预检请求"></a>简单请求与预检请求</h1><p>浏览器将CORS请求分成两类：简单请求(simple request)和非简单请求(not-so-simple request)。</p>
<p>简单请求是指满足以下条件的(一般只考虑前面两个条件即可)：</p>
<ol>
<li>使用 GET、POST、HEAD 其中一种请求方法。</li>
<li>HTTP的头信息不超出以下几种字段：<ul>
<li>Accept</li>
<li>Accept-Language</li>
<li>Content-Language</li>
<li>Last-Event-ID</li>
<li>Content-Type：只限于三个值 application/x-www-form-urlencoded、multipart/form-data、text/plain</li>
</ul>
</li>
<li>请求中的任意XMLHttpRequestUpload 对象均没有注册任何事件监听器；</li>
<li>XMLHttpRequestUpload 对象可以使用 XMLHttpRequest.upload 属性访问。 请求中没有使用 ReadableStream 对象。</li>
</ol>
<p>凡是不同时满足上面两个条件，就属于非简单请求。<strong>一句话，简单请求就是简单的 HTTP 方法与简单的 HTTP 头信息的结合。</strong></p>
<p>这样划分的原因是，表单在历史上一直可以跨域发出请求。简单请求就是表单请求，浏览器沿袭了传统的处理方式，不把行为复杂化，否则开发者可能转而使用表单，规避 CORS 的限制。对于非简单请求，浏览器会采用新的处理方式。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/01/31/%E8%B7%A8%E5%9F%9F/" data-id="cldjpozv2001098t4b20x3lbx" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/" rel="tag">浏览器</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-js中的基本数据类型" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/01/31/js%E4%B8%AD%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" class="article-date">
  <time datetime="2023-01-31T03:20:30.000Z" itemprop="datePublished">2023-01-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/01/31/js%E4%B8%AD%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/">js中的基本数据类型</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="变量的声明"><a href="#变量的声明" class="headerlink" title="变量的声明"></a>变量的声明</h1><p>目前定义变量可以使用三种关键字：var / let / const</p>
<table>
<thead>
<tr>
<th>变量</th>
<th>变量提升</th>
<th>暂时死区</th>
<th>重复声明</th>
<th>初始值</th>
<th>作用域</th>
<th>类型</th>
</tr>
</thead>
<tbody><tr>
<td>var</td>
<td>会</td>
<td>不存在</td>
<td>可重复声明</td>
<td>非必需</td>
<td>函数级</td>
<td>变量</td>
</tr>
<tr>
<td>let</td>
<td>不会</td>
<td>存在</td>
<td>不可重复声明</td>
<td>非必需</td>
<td>块级</td>
<td>变量</td>
</tr>
<tr>
<td>const</td>
<td>不会</td>
<td>存在</td>
<td>不可重复声明</td>
<td>必须</td>
<td>块级</td>
<td>常量</td>
</tr>
</tbody></table>
<p><code>const</code>实际上保证的，并不是变量的值不得改动，而是变量指向的那个内存地址不得改动。对于简单类型的数据（数值、字符串、布尔值），值就保存在变量指向的那个内存地址，因此等同于常量。但对于复合类型的数据（主要是对象和数组），变量指向的内存地址，保存的只是一个指针，**<code>const</code>只能保证这个指针是固定的**，至于它指向的数据结构是不是可变的，就完全不能控制了。因此，将一个对象声明为常量必须非常小心。如果真的要对一个对象进行常量化时，应该使用对象特性中的冻结。</p>
<h1 id="弱类型与强类型"><a href="#弱类型与强类型" class="headerlink" title="弱类型与强类型"></a>弱类型与强类型</h1><p>强类型、弱类型是指<strong>类型检查的严格程度</strong>。无论哪种语言，对于变量而言，都存在“类型”和“值”两个概念。对于强类型语言，要求所有的变量必须先定义（定义时必须声明数据类型）后使用，并且指定类型的变量只能接受类型与之匹配的值。</p>
<p>这意味着每个变量和每个表达式都有一个在编译时就确定的类型，类型限制了变量能赋的值，限制了表达式能产生的值同时也限制了在这些值上可以进行的操作。</p>
<p>强类型语言要求编译时进行更为严格的语法检查，减少了编程错误的发生。</p>
<p>弱类型的变量类型则是无需声明的，由解释器解释。<strong>同时也意味着允许进行隐式类型转换。</strong></p>
<p>总结：</p>
<ul>
<li>强类型的变量类型是一经声明不能改变的，在编译时就进行检查，如Java</li>
<li>弱类型变量是根据使用的情况随时改变的，由解释器解释，如JavaScript</li>
</ul>
<p>JavaScript 是一种「弱类型」或者说「动态语言」。这意味着你不用提前声明变量的类型，在程序运行过程中，类型会被自动确定。这也意味着你可以使用同一个变量保存不同类型的数据</p>
<h1 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h1><h2 id="八大数据类型"><a href="#八大数据类型" class="headerlink" title="八大数据类型"></a>八大数据类型</h2><p>前七种为基本数据类型，也称为原始类型（值本身无法被改变），而 <code>object</code> 为复杂数据类型。</p>
<p>其中八大数据类型分别是：</p>
<ul>
<li><code>number</code> 用于任何类型的数字：整数或浮点数，能表示的最大为 1.7976931348623157e+308 。其中 准确表示的整数范围在 2^53~2^53（不含两个端点）。可以通过 <code>Number.MAX_VALUE</code> , <code>Number.MIN_VALUE</code> 查看。</li>
<li><code>bigint</code> 用于任意长度的整数。于ES10中新增。</li>
<li><code>string</code> 用于字符串：一个字符串可以包含一个或多个字符，所以没有单独的单字符类型。</li>
<li><code>boolean</code> 用于 true 和 false。</li>
<li><code>null</code> 用于未知的值 —— 只有一个 <code>null</code> 值的独立类型。</li>
<li><code>undefined</code> 用于未定义的值 —— 只有一个 <code>undefined</code> 值的独立类型。</li>
<li><code>symbol</code> 用于唯一的标识符。于ES6中新增。</li>
<li><code>object</code> 用于更复杂的数据结构。</li>
</ul>
<h2 id="类型检测"><a href="#类型检测" class="headerlink" title="类型检测"></a>类型检测</h2><p>常用的类型检测手段有<code>typeof</code>和<code>instanceof</code></p>
<h3 id="typeof"><a href="#typeof" class="headerlink" title="typeof"></a>typeof</h3><p>用于判断一个一个表达式，（对象或者原始值），返回一个字符串</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>举例</th>
<th>结果</th>
</tr>
</thead>
<tbody><tr>
<td>Undefined</td>
<td>undefined</td>
<td><code>&quot;undefined&quot;</code></td>
</tr>
<tr>
<td>Null</td>
<td>null</td>
<td><code>&quot;object&quot;</code> (历史遗留问题)</td>
</tr>
<tr>
<td>Boolean</td>
<td>true</td>
<td><code>&quot;boolean&quot;</code></td>
</tr>
<tr>
<td>Number</td>
<td>1</td>
<td><code>&quot;number&quot;</code></td>
</tr>
<tr>
<td>BigInt</td>
<td>10n</td>
<td><code>&quot;bigint&quot;</code></td>
</tr>
<tr>
<td>String</td>
<td>“abc”</td>
<td><code>&quot;string&quot;</code></td>
</tr>
<tr>
<td>Symbol</td>
<td>Symbol(“id”)</td>
<td><code>&quot;symbol&quot;</code></td>
</tr>
<tr>
<td>宿主对象(由JS环境提供)</td>
<td></td>
<td>Implementation-dependent</td>
</tr>
<tr>
<td>函数对象</td>
<td>alert</td>
<td><code>&quot;function&quot;</code></td>
</tr>
<tr>
<td>任何其他对象</td>
<td>{}</td>
<td><code>&quot;object&quot;</code></td>
</tr>
</tbody></table>
<h3 id="instanceof"><a href="#instanceof" class="headerlink" title="instanceof"></a>instanceof</h3><p>运算符用来测试一个对象在其原型链中是否存在一个构造函数的 prototype 属性</p>
<p>要求前面是个对象，后面是一个构造函数。而且返回的是布尔型的</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">obj <span class="keyword">instanceof</span> <span class="title class_">Object</span><span class="comment">//true 实例obj在不在Object构造函数中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.instanceof的普通的用法，obj instanceof Object 检测Object.prototype是否存在于参数obj的原型链上</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p <span class="keyword">instanceof</span> <span class="title class_">Person</span>)<span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.继承中判断实例是否属于它的父类</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Student</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> <span class="title class_">Person</span>()</span><br><span class="line"><span class="title class_">Student</span>.<span class="property"><span class="keyword">prototype</span></span> = p <span class="comment">//继承原型</span></span><br><span class="line"><span class="keyword">var</span> s = <span class="keyword">new</span> <span class="title class_">Student</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(s <span class="keyword">instanceof</span> <span class="title class_">Student</span>) <span class="comment">//true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(s <span class="keyword">instanceof</span> <span class="title class_">Person</span>) <span class="comment">//true</span></span><br></pre></td></tr></table></figure>

<h2 id="复杂类型检测"><a href="#复杂类型检测" class="headerlink" title="复杂类型检测"></a>复杂类型检测</h2><p>由于<code>typeof</code>对复杂类型判断均为<code>object</code>，而具体到某个类时不起作用，因此需要其他方法判断。</p>
<ol>
<li><code>instanceof obj</code>：<code>instanceof</code> 运算符用来测试一个对象在其原型链中是否存在一个构造函数的<code>prototype</code>属性，意思就是该变量通过原型链上能否找到构造函数的<code>prototype</code>属性.</li>
<li><code>obj.constructor === constructorName</code>：根据对象的构造器判断</li>
<li><code>Object.prototype.toString.call(obj)</code>：返回<code>[object constructorName]</code>的字符串格式</li>
<li>使用<code>js</code>方法<code>Array.isArray(arr)</code>判断是否为数组，其他类型也有相同的方法。</li>
</ol>
<h1 id="隐式类型转换"><a href="#隐式类型转换" class="headerlink" title="隐式类型转换"></a>隐式类型转换</h1><table>
<thead>
<tr>
<th>值</th>
<th>转换为字符串</th>
<th>转换为数字</th>
<th>转换为布尔值</th>
<th>转换为对象</th>
</tr>
</thead>
<tbody><tr>
<td>undefined</td>
<td>“undefined”</td>
<td>NaN</td>
<td>false</td>
<td>throw TypeError</td>
</tr>
<tr>
<td>null</td>
<td>“null”</td>
<td>0</td>
<td>false</td>
<td>throw TypeError</td>
</tr>
<tr>
<td>true</td>
<td>“true”</td>
<td>1</td>
<td></td>
<td>new Boolean(“true”)</td>
</tr>
<tr>
<td>false</td>
<td>“false”</td>
<td>0</td>
<td></td>
<td>new Boolean(“false”)</td>
</tr>
<tr>
<td>“”<code>(空字符串)</code></td>
<td></td>
<td>0</td>
<td>false</td>
<td>new String(“”)</td>
</tr>
<tr>
<td>“1.2”<code>(非空，数字)</code></td>
<td></td>
<td>1.2</td>
<td>true</td>
<td>new String(“1.2”)</td>
</tr>
<tr>
<td>“1.2a”<code>(非空，混合)</code></td>
<td></td>
<td>NaN</td>
<td>true</td>
<td>new String(“1.2a”)</td>
</tr>
<tr>
<td>“aaa”<code>(非空，非数字)</code></td>
<td></td>
<td>NaN</td>
<td>true</td>
<td>new String(“aaa”)</td>
</tr>
<tr>
<td>0</td>
<td>“0”</td>
<td></td>
<td>false</td>
<td>new Number(0)</td>
</tr>
<tr>
<td>-0</td>
<td>“0”</td>
<td></td>
<td>false</td>
<td>new Number(-0)</td>
</tr>
<tr>
<td>1<code>(非零数)</code></td>
<td>“1”</td>
<td></td>
<td>true</td>
<td>new Number(1)</td>
</tr>
<tr>
<td>NaN</td>
<td>“NaN”</td>
<td></td>
<td>false</td>
<td>new Number(NaN)</td>
</tr>
<tr>
<td>Infinity</td>
<td>“Infinity”</td>
<td></td>
<td>true</td>
<td>new Number(Infinity)</td>
</tr>
<tr>
<td>-Infinity</td>
<td>“-Infinity”</td>
<td></td>
<td>true</td>
<td>new Number(-Infinity)</td>
</tr>
<tr>
<td>[]<code>(任意数组)</code></td>
<td>“”</td>
<td>0</td>
<td>true</td>
<td></td>
</tr>
<tr>
<td>[9]<code>(1个数字元素)</code></td>
<td>“9”</td>
<td>9</td>
<td>true</td>
<td></td>
</tr>
<tr>
<td>[“a”, “b”]<code>(其他数组)</code></td>
<td>“a,b”(join方法)</td>
<td>NaN</td>
<td>true</td>
<td></td>
</tr>
<tr>
<td>function(){}<code>(任意函数)</code></td>
<td>“function(){}”</td>
<td>NaN</td>
<td>true</td>
<td></td>
</tr>
</tbody></table>
<ul>
<li>数组类型的类型转换，数组转换为字符串,实际上是调用不传参数的 join() 方法</li>
<li>转为布尔类型成为false的有：undefined、null、空字符串、0、-0、NaN</li>
<li>字符串类型转为数值类型：<ul>
<li>若字符串中出现任意非数字、非空格的字符，均转为NaN</li>
<li>若数字中间存在空格，转为NaN</li>
<li>若希望尽可能的转换字符串中出现的数字，请参考parseInt、parseFloat方法</li>
</ul>
</li>
<li>new Number() 和 Number() 是不同的<ul>
<li>new Number() 创建一个Number对象</li>
<li>Number() 将传入的参数转换为数值字面量</li>
</ul>
</li>
</ul>
<h2 id="对象的类型转换"><a href="#对象的类型转换" class="headerlink" title="对象的类型转换"></a>对象的类型转换</h2><ol>
<li>对象到字符串的转换( 这里说的是<code>String()</code>方法的原理 )<ul>
<li>若具有<code>toString()</code>方法，调用<code>toString()</code>，如果它返回一个原始值，将这个原始值转换为字符串返回</li>
<li>若无<code>toString()</code>方法，或<code>toString()</code>的返回值并不是一个原始值，寻找其<code>valueOf()</code>方法，若存在这个方法，调用它，如果它返回一个原始值，将这个原始值转换为字符串返回</li>
<li>否则（无<code>valueOf()</code>或<code>valueOf()</code>的返回值不是原始值），JS无法从<code>toString()</code>或<code>valueOf()</code>方法获得一个原始值，因此，<code>throw TypeError</code></li>
</ul>
</li>
<li>对象到数字的转换（这里说的是<code>Number()</code>方法的原理）<ul>
<li>若具有<code>valueOf()</code>方法，调用<code>valueOf()</code>，如果它返回一个原始值，将这个原始值转换为数字返回</li>
<li>若无<code>valueOf()</code>方法，或<code>valueOf()</code>的返回值并不是一个原始值，寻找其<code>toString()</code>方法，若存在这个方法，调用它，如果它返回一个原始值，将这个原始值转换为数字返回</li>
<li>否则（无<code>toString()</code>或<code>toString()</code>的返回值不是原始值），JS无法从<code>toString()</code>或<code>valueOf()</code>方法获得一个原始值，因此，<code>throw TypeError</code> 对象到数字的转换和对象到字符串的转换类似，只是两个方法的调用顺序不同</li>
</ul>
</li>
<li>对象到布尔值的转换<ul>
<li>对象类型转换为布尔值：均为true，不管其<code>toString()</code>、<code>valueOf()</code>方法返回什么</li>
</ul>
</li>
</ol>
<h2 id="各类型的toString-、valueOf-方法的返回值"><a href="#各类型的toString-、valueOf-方法的返回值" class="headerlink" title="各类型的toString()、valueOf()方法的返回值"></a>各类型的<code>toString()</code>、<code>valueOf()</code>方法的返回值</h2><ul>
<li>对象<ul>
<li><code>toString()</code>返回：”[object Object]”</li>
<li><code>valueOf()</code>返回：对象本身</li>
</ul>
</li>
<li>数组<ul>
<li><code>toString()</code>返回：<code>this.join()</code>的返回值</li>
<li><code>valueOf()</code>返回：数组本身</li>
</ul>
</li>
<li>方法<ul>
<li><code>toString()</code>返回：整个函数字符串</li>
<li><code>valueOf()</code>返回：方法本身</li>
</ul>
</li>
<li>日期<ul>
<li><code>toString()</code>返回：完整事件字符串</li>
<li><code>valueOf()</code>返回：从1970年1月1日0时0分0秒（UTC，即协调世界时）到该日期的毫秒数。</li>
</ul>
</li>
<li>Error<ul>
<li><code>toString()</code>返回：”Error {错误描述}”</li>
<li><code>valueOf()</code>返回：错误本身</li>
</ul>
</li>
<li>RegExp<ul>
<li><code>toString()</code>返回：正则式完整字符串</li>
<li><code>valueOf()</code>返回：正则本身</li>
</ul>
</li>
</ul>
<h2 id="运算符中的隐式类型转换"><a href="#运算符中的隐式类型转换" class="headerlink" title="运算符中的隐式类型转换"></a>运算符中的隐式类型转换</h2><ol>
<li>算术运算符<code>（+、-、*、/、++、–、%…）</code><ul>
<li>‘+’作为一个双目运算符： 若+两边存在一个字符串，将另一个也转为字符串进行字符串拼接。</li>
<li>其他情况下，不管双目还是单目，都转为数值类型</li>
</ul>
</li>
<li>关系运算符<code>（&gt;、&lt;、==、!=…）</code><ul>
<li>===、!==：同时对比类型和值，两个都为真才返回真</li>
<li>==、!=: 若两边均为对象，对比它们的引用是否相同</li>
<li>逻辑非(!): 将其后变量或表达式转为布尔值</li>
<li>对比字符串：从头至尾扫描逐个比较每个字符的unicode码，直到分出大小</li>
<li>其他情况下，两边均转为数值类型</li>
</ul>
</li>
</ol>
<p>注意：<strong>NaN与任何值都不相同，与任何值比较都返回false</strong></p>
<p>对象类型在运算时进行类型转换都先调用 <code>valueOf()</code> 方法，再尝试 <code>toString()</code> 方法</p>
<p>在进行对象字面量(这里说的是JSON格式的对象字面量)运算时要注意，若运算符两边都是字面量，则将它们都视为对象字面量进行类型转换； 若只有一个字面量时要注意，当这个字面量在首位时，会被当做一个块看待。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#125; + &#123;&#125;         =&gt;     <span class="string">&quot;[object Object][object Object]&quot;</span></span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>] + []     =&gt;     <span class="string">&quot;1,2,3&quot;</span> + <span class="string">&quot;&quot;</span> -&gt;<span class="string">&quot;1,2,3&quot;</span> </span><br><span class="line">[] + &#123;&#125;         =&gt;     <span class="string">&quot;&quot;</span> + <span class="string">&quot;[object Object]&quot;</span> -&gt; <span class="string">&quot;[object Object]&quot;</span></span><br><span class="line">&#123;&#125; + []            =&gt;     <span class="number">0</span>    ---&gt; &#123;&#125;被当做一个块，相当于执行 (&#123;&#125;,+[])，返回值为小括号最后面的表达式的返回值</span><br><span class="line">&#123;<span class="attr">q</span>:<span class="number">1</span>&#125; + []         =&gt;     <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = &#123;<span class="attr">q</span>:<span class="number">1</span>&#125;;</span><br><span class="line">a + []     =&gt; <span class="string">&quot;[object Object]&quot;</span>     变量形式运算正常</span><br><span class="line">[] + <span class="function"><span class="params">a</span>      =&gt;</span> <span class="string">&quot;[object Object]&quot;</span></span><br><span class="line"></span><br><span class="line">&#123;&#125; == []  =&gt; 报错   (&#123;&#125;, ==[])-&gt;报错</span><br><span class="line">[] == <span class="number">0</span>   =&gt; <span class="literal">true</span>    []-&gt;<span class="string">&quot;&quot;</span>-&gt;<span class="number">0</span></span><br><span class="line">![] == <span class="number">0</span>  =&gt; <span class="literal">true</span>   ![]-&gt;<span class="literal">false</span>-&gt;<span class="number">0</span></span><br><span class="line">[] == ![] =&gt; <span class="literal">true</span>   []-&gt;<span class="string">&quot;&quot;</span>-&gt;<span class="number">0</span>  ![]-&gt;<span class="literal">false</span>-&gt;<span class="number">0</span></span><br><span class="line">[] == []  =&gt; <span class="literal">false</span>  比较引用地址</span><br><span class="line">&#123;&#125; == &#123;&#125;  =&gt; <span class="literal">false</span>  比较引用地址</span><br><span class="line">&#123;&#125; == !&#123;&#125; =&gt; <span class="literal">false</span>  !&#123;&#125;-&gt;<span class="literal">false</span>-&gt;<span class="number">0</span>  &#123;&#125;-&gt;<span class="string">&quot;[object Object]&quot;</span>-&gt;<span class="title class_">NaN</span></span><br></pre></td></tr></table></figure>

<h1 id="值的比较"><a href="#值的比较" class="headerlink" title="值的比较"></a>值的比较</h1><p>在 JS 中的值的比较与数学很类型：</p>
<ul>
<li>大于/小于/大于等于/小于等于：<code>a&gt;b</code> / <code>a /</code> a&gt;=b<code>/</code>a&lt;=b` ；</li>
<li>判断相等：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用 ==，非严格等于，不关心值类型</span></span><br><span class="line"><span class="comment">// == 运算符会对比较的操作数做隐式类型转换，再比较</span></span><br><span class="line"><span class="string">&#x27;1&#x27;</span> == <span class="number">1</span>; <span class="comment">// true</span></span><br><span class="line"><span class="comment">// 使用 ===，严格相等，关心值类型</span></span><br><span class="line"><span class="comment">// 将数字值 -0 和 +0 视为相等，并认为 Number.NaN 不等于 NaN。</span></span><br><span class="line"><span class="string">&#x27;1&#x27;</span> === <span class="number">1</span>; <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>x</th>
<th>y</th>
<th>==</th>
<th>===</th>
<th>Object.is()</th>
</tr>
</thead>
<tbody><tr>
<td>undefined</td>
<td>undefined</td>
<td>true</td>
<td>true</td>
<td>true</td>
</tr>
<tr>
<td>null</td>
<td>null</td>
<td>true</td>
<td>true</td>
<td>true</td>
</tr>
<tr>
<td>true</td>
<td>true</td>
<td>true</td>
<td>true</td>
<td>true</td>
</tr>
<tr>
<td>false</td>
<td>false</td>
<td>true</td>
<td>true</td>
<td>true</td>
</tr>
<tr>
<td>“foo”</td>
<td>“foo”</td>
<td>true</td>
<td>true</td>
<td>true</td>
</tr>
<tr>
<td>0</td>
<td>0</td>
<td>true</td>
<td>true</td>
<td>true</td>
</tr>
<tr>
<td>+0</td>
<td>-0</td>
<td>true</td>
<td>true</td>
<td>false</td>
</tr>
<tr>
<td>“”</td>
<td>false</td>
<td>true</td>
<td>false</td>
<td>false</td>
</tr>
<tr>
<td>“”</td>
<td>0</td>
<td>true</td>
<td>false</td>
<td>false</td>
</tr>
<tr>
<td>“0”</td>
<td>0</td>
<td>true</td>
<td>false</td>
<td>false</td>
</tr>
<tr>
<td>“17”</td>
<td>17</td>
<td>true</td>
<td>false</td>
<td>false</td>
</tr>
<tr>
<td>[1,2]</td>
<td>“1,2”</td>
<td>true</td>
<td>false</td>
<td>false</td>
</tr>
<tr>
<td>new String(“foo”)</td>
<td>“foo”</td>
<td>true</td>
<td>false</td>
<td>false</td>
</tr>
<tr>
<td>null</td>
<td>undefined</td>
<td><strong>true</strong></td>
<td>false</td>
<td>false</td>
</tr>
<tr>
<td>null</td>
<td>false</td>
<td>false</td>
<td>false</td>
<td>false</td>
</tr>
<tr>
<td>undefined</td>
<td>false</td>
<td>false</td>
<td>false</td>
<td>false</td>
</tr>
<tr>
<td>{ foo: “bar” }</td>
<td>{ foo: “bar” }</td>
<td>false</td>
<td>false</td>
<td>false</td>
</tr>
<tr>
<td>new String(“foo”)</td>
<td>new String(“foo”)</td>
<td>false</td>
<td>false</td>
<td>false</td>
</tr>
<tr>
<td>0</td>
<td>null</td>
<td>false</td>
<td>false</td>
<td>false</td>
</tr>
<tr>
<td>0</td>
<td>NaN</td>
<td>false</td>
<td>false</td>
<td>false</td>
</tr>
<tr>
<td>“foo”</td>
<td>NaN</td>
<td>false</td>
<td>false</td>
<td>false</td>
</tr>
<tr>
<td>NaN</td>
<td>NaN</td>
<td>false</td>
<td>false</td>
<td>true</td>
</tr>
</tbody></table>
<h2 id="关系运算符和相等运算符"><a href="#关系运算符和相等运算符" class="headerlink" title="关系运算符和相等运算符"></a>关系运算符和相等运算符</h2><p>两者存在较大区别</p>
<ol>
<li>关系运算符 和 相等运算符 并不是一个类别的.</li>
<li>关系运算符,在设计上,总是需要运算元尝试转为一个number . 而相等运算符在设计上,则没有这方面的考虑.</li>
<li>最重要的一点, 不要把 拿 a &gt; b , a == b 的结果 想当然的去和 a &gt;= b 建立联系. 正确的符合最初设计思想的关系是 a &gt; b 与 a &gt;= b是一组 . a == b 和其他相等运算符才是一组. 比如 a === b , a != b, a !== b .</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">null</span> &gt; <span class="number">0</span>   <span class="comment">// null 尝试转型为number , 则为0 . 所以结果为 false, </span></span><br><span class="line"><span class="literal">null</span> &gt;= <span class="number">0</span>  <span class="comment">// null 尝试转为number ,则为0 , 结果为 true. </span></span><br><span class="line"><span class="literal">null</span> == <span class="number">0</span>  <span class="comment">// null在设计上，在此处不尝试转型. 所以 结果为false. </span></span><br></pre></td></tr></table></figure>

<h2 id="相等性判断Object-is"><a href="#相等性判断Object-is" class="headerlink" title="相等性判断Object.is()"></a>相等性判断Object.is()</h2><p>ES6 新增 Object.is 方法判断两个值是否相同，语法如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="title function_">is</span>(value1, value2);</span><br></pre></td></tr></table></figure>

<p>以下任意项成立则两个值相同：</p>
<ul>
<li><p>两个值都是 <code>undefined</code></p>
</li>
<li><p>两个值都是 <code>null</code></p>
</li>
<li><p>两个值都是 <code>true</code> 或者都是 <code>false</code></p>
</li>
<li><p>两个值是由相同个数的字符按照相同的顺序组成的字符串</p>
</li>
<li><p>两个值指向同一个对象</p>
</li>
<li><p>两个值都是数字并且</p>
</li>
<li><ul>
<li>都是正零 <code>+0</code></li>
<li>都是负零 <code>-0</code></li>
<li>都是 <code>NaN</code></li>
<li>都是除零和 <code>NaN</code> 外的其它同一个数字 使用示例：</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="title function_">is</span>(<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;foo&#x27;</span>);     <span class="comment">// true</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">is</span>(<span class="variable language_">window</span>, <span class="variable language_">window</span>);   <span class="comment">// true</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">is</span>(<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>);     <span class="comment">// false</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">is</span>([], []);           <span class="comment">// false</span></span><br><span class="line"><span class="keyword">var</span> foo = &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> bar = &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">is</span>(foo, foo);         <span class="comment">// true</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">is</span>(foo, bar);         <span class="comment">// false</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">is</span>(<span class="literal">null</span>, <span class="literal">null</span>);       <span class="comment">// true</span></span><br><span class="line"><span class="comment">// 特例</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">is</span>(<span class="number">0</span>, -<span class="number">0</span>);            <span class="comment">// false</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">is</span>(<span class="number">0</span>, +<span class="number">0</span>);            <span class="comment">// true</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">is</span>(-<span class="number">0</span>, -<span class="number">0</span>);           <span class="comment">// true</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">is</span>(<span class="title class_">NaN</span>, <span class="number">0</span>/<span class="number">0</span>);         <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h2 id="null和undefined"><a href="#null和undefined" class="headerlink" title="null和undefined"></a>null和undefined</h2><p>null： Null类型，代表“空值”，代表一个空对象指针，使用typeof运算得到 “object”。</p>
<p>undefined： Undefined类型，当一个声明了一个变量未初始化时，得到的就是undefined。</p>
<h3 id="null和undefined值的比较"><a href="#null和undefined值的比较" class="headerlink" title="null和undefined值的比较"></a>null和undefined值的比较</h3><p>它们之间的比较</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="literal">undefined</span> == <span class="literal">null</span>) <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="literal">undefined</span> === <span class="literal">null</span>) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<p>对于其他比较 ，null和undefined会先转换位数字：<code>null</code> 转换为 <code>0</code> ， <code>undefied</code> 转换为 <code>NaN</code></p>
<p>需要注意：<code>null == 0; // false</code> 这里是因为：undefined 和 null 在相等性检查 == 中「不会进行任何的类型转换」，它们有自己独立的比较规则，所以除了它们之间互等外，不会等于任何其他的值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="literal">null</span> &gt; <span class="number">0</span>) <span class="comment">// false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="literal">null</span> &gt;= <span class="number">0</span>) <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="literal">null</span> == <span class="number">0</span>) <span class="comment">// false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="literal">null</span> &lt; <span class="number">1</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>第 1、2 行都返回 <code>false</code> 是因为 <code>undefined</code> 在比较中被转换为了 <code>NaN</code>，而 <code>NaN</code> 是一个特殊的数值型值，它与任何值进行比较都会返回 <code>false</code>。第 3 行返回 <code>false</code> 是因为这是一个相等性检查，而 <code>undefined</code> 只与 <code>null</code> 相等，不会与其他值相等。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="literal">undefined</span> &gt; <span class="number">0</span>) <span class="comment">// false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="literal">undefined</span> &gt; <span class="number">1</span>) <span class="comment">// false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="literal">undefined</span> == <span class="number">0</span>) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<h1 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h1><p>逻辑运算符如下表所示 (其中<code>*expr*</code>可能是任何一种类型Data_structure), 不一定是布尔值):</p>
<table>
<thead>
<tr>
<th>运算符</th>
<th>语法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>逻辑与，AND（<code>&amp;&amp;</code>）</td>
<td><code>expr1 &amp;&amp; expr2</code></td>
<td>若 <code>expr1</code> 可转换为 <code>true</code>，则返回 <code>expr2</code>；否则，返回 <code>expr1</code>。</td>
</tr>
<tr>
<td>逻辑或，OR（`</td>
<td></td>
<td>`）</td>
</tr>
<tr>
<td>逻辑非，NOT（<code>!</code>）</td>
<td><code>!expr</code></td>
<td>若 <code>expr</code> 可转换为 <code>true</code>，则返回 <code>false</code>；否则，返回 <code>true</code>。</td>
</tr>
</tbody></table>
<p>如果一个值可以被转换为 <code>true</code>，那么这个值就是所谓的 truthy，如果可以被转换为 <code>false</code>，那么这个值就是所谓的 falsy。</p>
<p>会被转换为 <code>false</code> 的表达式有：</p>
<ul>
<li><code>null</code>；</li>
<li><code>NaN</code>；</li>
<li><code>0</code>；</li>
<li>空字符串（<code>&quot;&quot;</code> or <code>&#39;&#39;</code> or ````）；</li>
<li><code>undefined</code>。</li>
</ul>
<p>尽管 <code>&amp;&amp;</code> 和 <code>||</code> 运算符能够使用非布尔值的操作数, 但它们依然可以被看作是布尔操作符，因为它们的返回值总是能够被转换为布尔值。如果要显式地将它们的返回值（或者表达式）转换为布尔值，请使用双重非运算符（即<code>!!</code>）或者Boolean构造函数。</p>
<h2 id="逻辑与（-amp-amp-）"><a href="#逻辑与（-amp-amp-）" class="headerlink" title="逻辑与（&amp;&amp;）"></a>逻辑与（<code>&amp;&amp;</code>）</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">a1 = <span class="literal">true</span>  &amp;&amp; <span class="literal">true</span>      <span class="comment">// t &amp;&amp; t 返回 true</span></span><br><span class="line">a2 = <span class="literal">true</span>  &amp;&amp; <span class="literal">false</span>     <span class="comment">// t &amp;&amp; f 返回 false</span></span><br><span class="line">a3 = <span class="literal">false</span> &amp;&amp; <span class="literal">true</span>      <span class="comment">// f &amp;&amp; t 返回 false</span></span><br><span class="line">a4 = <span class="literal">false</span> &amp;&amp; (<span class="number">3</span> == <span class="number">4</span>)  <span class="comment">// f &amp;&amp; f 返回 false</span></span><br><span class="line">a5 = <span class="string">&quot;Cat&quot;</span> &amp;&amp; <span class="string">&quot;Dog&quot;</span>     <span class="comment">// t &amp;&amp; t 返回 &quot;Dog&quot;</span></span><br><span class="line">a6 = <span class="literal">false</span> &amp;&amp; <span class="string">&quot;Cat&quot;</span>     <span class="comment">// f &amp;&amp; t 返回 false</span></span><br><span class="line">a7 = <span class="string">&quot;Cat&quot;</span> &amp;&amp; <span class="literal">false</span>     <span class="comment">// t &amp;&amp; f 返回 false</span></span><br><span class="line">a8 = <span class="string">&#x27;&#x27;</span>    &amp;&amp; <span class="literal">false</span>     <span class="comment">// f &amp;&amp; f 返回 &quot;&quot;</span></span><br><span class="line">a9 = <span class="literal">false</span> &amp;&amp; <span class="string">&#x27;&#x27;</span>        <span class="comment">// f &amp;&amp; f 返回 false</span></span><br></pre></td></tr></table></figure>

<h2 id="逻辑或（-）"><a href="#逻辑或（-）" class="headerlink" title="逻辑或（||）"></a>逻辑或（<code>||</code>）</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">o1 = <span class="literal">true</span>  || <span class="literal">true</span>      <span class="comment">// t || t 返回 true</span></span><br><span class="line">o2 = <span class="literal">false</span> || <span class="literal">true</span>      <span class="comment">// f || t 返回 true</span></span><br><span class="line">o3 = <span class="literal">true</span>  || <span class="literal">false</span>     <span class="comment">// t || f 返回 true</span></span><br><span class="line">o4 = <span class="literal">false</span> || (<span class="number">3</span> == <span class="number">4</span>)  <span class="comment">// f || f 返回 false</span></span><br><span class="line">o5 = <span class="string">&quot;Cat&quot;</span> || <span class="string">&quot;Dog&quot;</span>     <span class="comment">// t || t 返回 &quot;Cat&quot;</span></span><br><span class="line">o6 = <span class="literal">false</span> || <span class="string">&quot;Cat&quot;</span>     <span class="comment">// f || t 返回 &quot;Cat&quot;</span></span><br><span class="line">o7 = <span class="string">&quot;Cat&quot;</span> || <span class="literal">false</span>     <span class="comment">// t || f 返回 &quot;Cat&quot;</span></span><br><span class="line">o8 = <span class="string">&#x27;&#x27;</span>    || <span class="literal">false</span>     <span class="comment">// f || f 返回 false</span></span><br><span class="line">o9 = <span class="literal">false</span> || <span class="string">&#x27;&#x27;</span>        <span class="comment">// f || f 返回 &quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="逻辑非（-）"><a href="#逻辑非（-）" class="headerlink" title="逻辑非（!）"></a>逻辑非（<code>!</code>）</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">n1 = !<span class="literal">true</span>              <span class="comment">// !t 返回 false</span></span><br><span class="line">n2 = !<span class="literal">false</span>             <span class="comment">// !f 返回 true</span></span><br><span class="line">n3 = !<span class="string">&#x27;&#x27;</span>                <span class="comment">// !f 返回 true</span></span><br><span class="line">n4 = !<span class="string">&#x27;Cat&#x27;</span>             <span class="comment">// !t 返回 false</span></span><br></pre></td></tr></table></figure>

<h2 id="双重非（-）"><a href="#双重非（-）" class="headerlink" title="双重非（!!）"></a>双重非（<code>!!</code>）</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">n1 = !!<span class="literal">true</span>                   <span class="comment">// !!truthy 返回 true</span></span><br><span class="line">n2 = !!&#123;&#125;                     <span class="comment">// !!truthy 返回 true: 任何 对象都是 truthy 的…</span></span><br><span class="line">n3 = !!(<span class="keyword">new</span> <span class="title class_">Boolean</span>(<span class="literal">false</span>))   <span class="comment">// …甚至 .valueOf() 返回 false 的布尔值对象也是！</span></span><br><span class="line">n4 = !!<span class="literal">false</span>                  <span class="comment">// !!falsy 返回 false</span></span><br><span class="line">n5 = !!<span class="string">&quot;&quot;</span>                     <span class="comment">// !!falsy 返回 false</span></span><br><span class="line">n6 = !!<span class="title class_">Boolean</span>(<span class="literal">false</span>)         <span class="comment">// !!falsy 返回 false</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/01/31/js%E4%B8%AD%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" data-id="cldjpozuv000e98t47a1z2ffe" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-vuex" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/01/31/vuex/" class="article-date">
  <time datetime="2023-01-31T03:20:19.000Z" itemprop="datePublished">2023-01-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/01/31/vuex/">vuex</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="状态管理"><a href="#状态管理" class="headerlink" title="状态管理"></a>状态管理</h1><h2 id="什么是状态管理"><a href="#什么是状态管理" class="headerlink" title="什么是状态管理"></a>什么是状态管理</h2><p>在开发中，我们会的应用程序需要处理各种各样的数据，这些数据需要保存在我们应用程序中的某一个位置，对于这些数据的管理我们就称之为是 状态管理。</p>
<p>在Vue开发中，我们使用组件化的开发方式<br>而在组件中我们定义data或者在setup中返回使用的数据，这些数据我们称之为state<br>在模块template中我们可以使用这些数据，模块最终会被渲染成DOM，我们称之为View<br>在模块中我们会产生一些行为事件，处理这些行为事件时，有可能会修改state，这些行为事件我们称之为actions</p>
<h2 id="复杂的状态管理"><a href="#复杂的状态管理" class="headerlink" title="复杂的状态管理"></a>复杂的状态管理</h2><p>JavaScript开发的应用程序，已经变得越来越复杂了：</p>
<ul>
<li>JavaScript需要管理的状态越来越多，越来越复杂；</li>
<li>这些状态包括服务器返回的数据、缓存数据、用户操作产生的数据等等；</li>
<li>也包括一些UI的状态，比如某些元素是否被选中，是否显示加载动效，当前分页；</li>
</ul>
<p>当我们的应用遇到多个组件共享状态时，单向数据流的简洁性很容易被破坏：</p>
<ul>
<li>多个视图依赖于同一状态；</li>
<li>来自不同视图的行为需要变更同一状态；</li>
</ul>
<p>我们是否可以通过组件数据的传递来完成呢</p>
<ul>
<li>对于一些简单的状态，确实可以通过props的传递或者Provide的方式来共享状态</li>
<li>但是对于复杂的状态管理来说，显然单纯通过传递和共享的方式是不足以解决问题的</li>
</ul>
<h2 id="vuex的状态管理"><a href="#vuex的状态管理" class="headerlink" title="vuex的状态管理"></a>vuex的状态管理</h2><p>管理不断变化的state本身是非常困难的</p>
<ul>
<li>状态之间相互会存在依赖，一个状态的变化会引起另一个状态的变化，View页面也有可能会引起状态的变化；</li>
<li>当应用程序复杂时，state在什么时候，因为什么原因而发生了变化，发生了怎么样的变化，会变得非常难以控制和追踪；</li>
</ul>
<p>因此，我们是否可以考虑将组件的内部状态抽离出来</p>
<ul>
<li>在这种模式下，我们的组件树构成了一个巨大的 “试图View”</li>
<li>不管在树的哪个位置，任何组件都能获取状态或者触发行为</li>
<li>通过定义和隔离状态管理中的各个概念，并通过强制性的规则来维护视图和状态间的独立性，我们的代码边会变得更加结构化和易于维护、跟踪</li>
</ul>
<p>这就是Vuex背后的基本思想，它借鉴了Flux、Redux、Elm（纯函数语言，redux有借鉴它的思想）</p>
<h1 id="vuex"><a href="#vuex" class="headerlink" title="vuex"></a>vuex</h1><p>每一个Vuex应用的核心就是store（仓库），store本质上是一个容器，它包含着你的应用中大部分的状态（state）</p>
<h2 id="vuex状态管理概述"><a href="#vuex状态管理概述" class="headerlink" title="vuex状态管理概述"></a>vuex状态管理概述</h2><p><img src="/2023/01/31/vuex/vuex-cycle.png"></p>
<h3 id="单一状态树"><a href="#单一状态树" class="headerlink" title="单一状态树"></a>单一状态树</h3><p>Vuex 使用单一状态树</p>
<ul>
<li>用一个对象就包含了全部的应用层级状；</li>
<li>采用的是SSOT，Single Source of Truth，也可以翻译成单一数据源； p</li>
<li>这也意味着，每个应用将仅仅包含一个 store 实例；</li>
<li>单状态树和模块化并不冲突，后面我们会讲到module的概念</li>
</ul>
<p>单一状态树的优势</p>
<ul>
<li>如果你的状态信息是保存到多个Store对象中的，那么之后的管理和维护等等都会变得特别困难</li>
<li>所以Vuex也使用了单一状态树来管理应用层级的全部状态</li>
<li>单一状态树能够让我们最直接的方式找到某个状态的片段，而且在之后的维护和调试过程中，也可以非常方便的管理和维护</li>
</ul>
<h3 id="Vuex和单纯的全局对象的区别"><a href="#Vuex和单纯的全局对象的区别" class="headerlink" title="Vuex和单纯的全局对象的区别"></a>Vuex和单纯的全局对象的区别</h3><ul>
<li>Vuex的状态存储是响应式的<ul>
<li>当Vue组件从store中读取状态的时候，若store中的状态发生变化，那么相应的组件也会被更新</li>
</ul>
</li>
<li>你不能直接改变store中的状态<ul>
<li>改变store中的状态的唯一途径就显示提交 (commit) mutation</li>
<li>这样使得我们可以方便的跟踪每一个状态的变化，从而让我们能够通过一些工具帮助我们更好的管理应用的状态</li>
</ul>
</li>
</ul>
<h2 id="store的创建"><a href="#store的创建" class="headerlink" title="store的创建"></a>store的创建</h2><p>使用和vue-router类似，创建store对象并让app注册</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建store</span></span><br><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">createStore</span>(&#123;</span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">modules</span>: &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js use-store</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>).<span class="title function_">use</span>(store)</span><br></pre></td></tr></table></figure>

<h2 id="state"><a href="#state" class="headerlink" title="state"></a>state</h2><h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><p>以<code>state.counter</code>为例</p>
<ul>
<li>在模板中可以使用<code>$store.state.counter</code></li>
<li>在options api中可以使用<code>this.$store.state.counter</code></li>
<li>在composition api中<ul>
<li>可以通过<code>import &#123; useStore &#125; from &#39;vuex&#39;</code></li>
<li><code>new useStore()</code>中获取</li>
</ul>
</li>
<li>通过用mapState的辅助函数获取（需要获取较多state时可用）</li>
</ul>
<h3 id="composition-api中的批量映射"><a href="#composition-api中的批量映射" class="headerlink" title="composition api中的批量映射"></a>composition api中的批量映射</h3><p>默认情况下，Vuex并没有提供非常方便的使用mapState的方式，这里我们进行了一个函数的封装</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useStore, mapState &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; computed &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useState</span>(<span class="params">mapper</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title function_">useStore</span>()</span><br><span class="line">  <span class="keyword">const</span> stateFns = <span class="title function_">mapState</span>(mapper)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> state = &#123;&#125;</span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">keys</span>(stateFns).<span class="title function_">forEach</span>(<span class="function">(<span class="params">fnKey</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// mapState中实际上是通过 this.$store.state获取状态</span></span><br><span class="line">    <span class="comment">// 但是目前取出的stateFns[fnKey]没有this，因此要通过bind绑定</span></span><br><span class="line">    <span class="keyword">const</span> fn = stateFns[fnKey].<span class="title function_">bind</span>(&#123; <span class="attr">$store</span>: store &#125;)</span><br><span class="line">    state[fnKey] = <span class="title function_">computed</span>(fn)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> state</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="getters"><a href="#getters" class="headerlink" title="getters"></a>getters</h2><h3 id="基本使用-1"><a href="#基本使用-1" class="headerlink" title="基本使用"></a>基本使用</h3><p>某些属性我们可能需要警告变化后来使用，这个时候可以使用getters<br>实际上类似于computed</p>
<p>传入2个参数</p>
<ul>
<li>state：可以获取store中的state</li>
<li>getters：可以获取所有getters</li>
</ul>
<p>另外可以通过返回一个函数 达到filter的效果</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">createStore</span>(&#123;</span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    <span class="attr">discount</span>: <span class="number">0.9</span>,</span><br><span class="line">    <span class="attr">books</span>: [</span><br><span class="line">      &#123; <span class="attr">name</span>: <span class="string">&#x27;1&#x27;</span>, <span class="attr">price</span>: <span class="number">12</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">name</span>: <span class="string">&#x27;2&#x27;</span>, <span class="attr">price</span>: <span class="number">16</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">name</span>: <span class="string">&#x27;3&#x27;</span>, <span class="attr">price</span>: <span class="number">34</span> &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">getters</span>: &#123;</span><br><span class="line">    <span class="title function_">booksTotalPrice</span>(<span class="params">state</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> state.<span class="property">books</span>.<span class="title function_">reduce</span>(<span class="function">(<span class="params">pre, cur</span>) =&gt;</span> pre + cur.<span class="property">price</span>, <span class="number">0</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 第二个参数可以获取getters</span></span><br><span class="line">    <span class="title function_">currentDiscount</span>(<span class="params">state, getters</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> (state.<span class="property">discount</span> * getters.<span class="property">booksTotalPrice</span>).<span class="title function_">toFixed</span>(<span class="number">2</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 可以通过返回函数达到filter的效果</span></span><br><span class="line">    <span class="title function_">filterTotalPrice</span>(<span class="params">state</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">lowerPrice</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> sum = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> book <span class="keyword">of</span> state.<span class="property">books</span>) &#123;</span><br><span class="line">          <span class="keyword">if</span> (book.<span class="property">price</span> &lt;= lowerPrice) sum += book.<span class="property">price</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;h2&gt;booksTotalPrice: &#123;&#123; $store.getters.booksTotalPrice &#125;&#125;&lt;/h2&gt;</span><br><span class="line">&lt;h2&gt;booksTotalPrice: &#123;&#123; $store.getters.currentDiscount &#125;&#125;&lt;/h2&gt;</span><br><span class="line">&lt;h2&gt;filterTotalPrice: &#123;&#123; $store.getters.filterTotalPrice(20) &#125;&#125;&lt;/h2&gt;</span><br></pre></td></tr></table></figure>

<h3 id="composition-api中的批量映射-1"><a href="#composition-api中的批量映射-1" class="headerlink" title="composition api中的批量映射"></a>composition api中的批量映射</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useStore, mapGetters &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; computed &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useGetters</span>(<span class="params">mapper</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title function_">useStore</span>()</span><br><span class="line">  <span class="keyword">const</span> getterFns = <span class="title function_">mapGetters</span>(mapper)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> getter = &#123;&#125;</span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">keys</span>(getterFns).<span class="title function_">forEach</span>(<span class="function">(<span class="params">fnKey</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// mapGetters中实际上是通过 this.$store.getters获取状态</span></span><br><span class="line">    <span class="comment">// 但是目前取出的getterFns[fnKey]没有this，因此要通过bind绑定</span></span><br><span class="line">    <span class="keyword">const</span> fn = getterFns[fnKey].<span class="title function_">bind</span>(&#123; <span class="attr">$store</span>: store &#125;)</span><br><span class="line">    getter[fnKey] = <span class="title function_">computed</span>(fn)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> getter</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="mutasions"><a href="#mutasions" class="headerlink" title="mutasions"></a>mutasions</h2><h3 id="基本使用-2"><a href="#基本使用-2" class="headerlink" title="基本使用"></a>基本使用</h3><p>更改 Vuex 的 store 中的状态的唯一方法是提交 mutation</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">createStore</span>(&#123;</span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    <span class="attr">counter</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">user</span>: &#123; <span class="attr">name</span>: <span class="string">&#x27;123&#x27;</span>, <span class="attr">age</span>: <span class="number">12</span> &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123;</span><br><span class="line">    <span class="title function_">addConuter</span>(<span class="params">state, payload = <span class="number">1</span></span>) &#123;</span><br><span class="line">      state.<span class="property">counter</span> += payload</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">redCounter</span>(<span class="params">state, payload = <span class="number">1</span></span>) &#123;</span><br><span class="line">      state.<span class="property">counter</span> -= payload</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">setUserInfo</span>(<span class="params">state, payload</span>) &#123;</span><br><span class="line">      state.<span class="property">user</span>.<span class="property">name</span> = payload.<span class="property">name</span></span><br><span class="line">      state.<span class="property">user</span>.<span class="property">age</span> = payload.<span class="property">age</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">store.<span class="title function_">commit</span>(<span class="string">&#x27;addConuter&#x27;</span>, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">store.<span class="title function_">commit</span>(<span class="string">&#x27;setUserInfo&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;李四&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">23</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 不同风格</span></span><br><span class="line">store.<span class="title function_">commit</span>(&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;setUserInfo&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;李四&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">23</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="mapMutations"><a href="#mapMutations" class="headerlink" title="mapMutations"></a>mapMutations</h3><p>我们也可以借助于辅助函数，帮助我们快速映射到对应的方法中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mapMutations &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">const</span> mutations = <span class="title function_">mapMutations</span>([<span class="string">&#x27;addConuter&#x27;</span>, <span class="string">&#x27;redCounter&#x27;</span>])</span><br></pre></td></tr></table></figure>

<h2 id="actions"><a href="#actions" class="headerlink" title="actions"></a>actions</h2><h3 id="基本使用-3"><a href="#基本使用-3" class="headerlink" title="基本使用"></a>基本使用</h3><p>Action类似于mutation，不同在于</p>
<ul>
<li>Action提交的是mutation，而不是直接变更状态</li>
<li>Action可以包含任意异步操作</li>
</ul>
<p>这里有一个非常重要的参数context</p>
<ul>
<li>context是一个和store实例均有相同方法和属性的context对象</li>
<li>所以我们可以从其中获取到commit方法来提交一个mutation，或者通过 context.state 和 context.getters 来获取 state 和 getters</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">createStore</span>(&#123;</span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    <span class="attr">counter</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">user</span>: &#123; <span class="attr">name</span>: <span class="string">&#x27;123&#x27;</span>, <span class="attr">age</span>: <span class="number">12</span> &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123;</span><br><span class="line">    <span class="title function_">ADD_COUNTER</span>(<span class="params">state, payload = <span class="number">1</span></span>) &#123;</span><br><span class="line">      state.<span class="property">counter</span> += payload</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">SET_USER_INFO</span>(<span class="params">state, payload</span>) &#123;</span><br><span class="line">      state.<span class="property">user</span>.<span class="property">name</span> = payload.<span class="property">name</span></span><br><span class="line">      state.<span class="property">user</span>.<span class="property">age</span> = payload.<span class="property">age</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="title function_">addCounter</span>(<span class="params">context, payload</span>) &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        context.<span class="title function_">commit</span>(<span class="string">&#x27;ADD_COUNTER&#x27;</span>, payload)</span><br><span class="line">      &#125;, <span class="number">1000</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">setUserInfo</span>(<span class="params">state, payload</span>) &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        context.<span class="title function_">commit</span>(<span class="string">&#x27;SET_USER_INFO&#x27;</span>, payload)</span><br><span class="line">      &#125;, <span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 执行</span></span><br><span class="line">store.<span class="title function_">dispatch</span>(<span class="string">&#x27;addCounter&#x27;</span>, <span class="number">10</span>)</span><br><span class="line">store.<span class="title function_">dispatch</span>(<span class="string">&#x27;setUserInfo&#x27;</span>, &#123; <span class="attr">name</span>: <span class="string">&#x27;张三&#x27;</span>, <span class="attr">age</span>: <span class="number">12</span>&#125;)</span><br><span class="line"><span class="comment">// 不同风格</span></span><br><span class="line">store.<span class="title function_">dispatch</span>(&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;setUserInfo&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;张三&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">12</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="mapActions"><a href="#mapActions" class="headerlink" title="mapActions"></a>mapActions</h3><p>我们也可以借助于辅助函数，帮助我们快速映射到对应的方法中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mapActions &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">const</span> actions = <span class="title function_">mapActions</span>([<span class="string">&#x27;addConuter&#x27;</span>, <span class="string">&#x27;redCounter&#x27;</span>])</span><br></pre></td></tr></table></figure>

<h3 id="actions中的context"><a href="#actions中的context" class="headerlink" title="actions中的context"></a>actions中的context</h3><ul>
<li>commit: 当前模块的commit</li>
<li>dispatch: 当前模块的dispatch</li>
<li>getters: 当前模块的getters</li>
<li>rootGetters: 根模块的getters</li>
<li>rootState: 根模块的rootState</li>
<li>state: 当前模块的state</li>
</ul>
<h3 id="actions异步回调"><a href="#actions异步回调" class="headerlink" title="actions异步回调"></a>actions异步回调</h3><p>Action 通常是异步的，如果我们需要知道action什么时候结束，可以通过常见异步方式解决</p>
<p>比如返回Promise，在Promise的then中来处理完成后的操作</p>
<h2 id="module"><a href="#module" class="headerlink" title="module"></a>module</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>由于使用单一状态树，应用的所有状态会集中到一个比较大的对象，当应用变得非常复杂时，store 对象就有可能变得相当臃肿<br>为了解决以上问题，Vuex 允许我们将 store 分割成模块（module）<br>每个模块拥有自己的 state、mutation、action、getter、甚至是嵌套子模块</p>
<h3 id="基本使用-4"><a href="#基本使用-4" class="headerlink" title="基本使用"></a>基本使用</h3><p>如果想获取模块里的state时，只需要按照<code>store.state[模块名]</code>即可</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">createStore</span>(&#123;</span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    <span class="attr">counter</span>: <span class="number">0</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">modules</span>: &#123;</span><br><span class="line">    <span class="attr">user</span>: &#123;</span><br><span class="line">      <span class="attr">state</span>: &#123;</span><br><span class="line">        <span class="attr">userInfo</span>: &#123;</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&#x27;张三&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">counter</span>: <span class="number">1</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">store.<span class="property">state</span>.<span class="property">user</span> <span class="comment">// vuex会对所有state按模块名合并在根上</span></span><br></pre></td></tr></table></figure>

<h3 id="命名空间"><a href="#命名空间" class="headerlink" title="命名空间"></a>命名空间</h3><p>默认情况下，模块内部的action和mutation仍然是注册在全局的命名空间中的</p>
<ul>
<li>这样使得多个模块能够对同一个 action 或 mutation 作出响应</li>
<li>Getter 同样也默认注册在全局命名空间</li>
</ul>
<p>如果我们希望模块具有更高的封装度和复用性，可以添加 namespaced: true 的方式使其成为带命名空间的模块</p>
<ul>
<li>当模块被注册后，它的所有 getter、action 及 mutation 都会自动根据模块注册的路径调整命名</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// user模块</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">namespaced</span>: <span class="literal">true</span>, <span class="comment">// 必须</span></span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    <span class="attr">userInfo</span>: &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;张三&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">counter</span>: <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">getters</span>: &#123;</span><br><span class="line">    <span class="title function_">getUserInfo</span>(<span class="params">state</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> state.<span class="property">userInfo</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123;</span><br><span class="line">    <span class="title function_">SET_USER_INFO</span>(<span class="params">state, payload</span>) &#123;</span><br><span class="line">      state.<span class="property">userInfo</span> = payload</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 触发</span></span><br><span class="line">store.<span class="property">getters</span>[<span class="string">&#x27;user/getUserInfo&#x27;</span>]</span><br><span class="line">store.<span class="property">commit</span>[<span class="string">&#x27;user/getUserInfo&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h3 id="辅助函数"><a href="#辅助函数" class="headerlink" title="辅助函数"></a>辅助函数</h3><p>以state为例，actions和mutations同理</p>
<p>如果辅助函数有三种使用方法： </p>
<ul>
<li>通过完整的模块空间名称来查找； </li>
<li>第一个参数传入模块空间名称，后面写上要使用的属性；</li>
<li>通过 createNamespacedHelpers 生成一个模块的辅助函数</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 目前定义模块为 user 同上</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">computed</span>: &#123;</span><br><span class="line">      <span class="comment">// 写法1</span></span><br><span class="line">    ...<span class="title function_">mapState</span>(&#123;</span><br><span class="line">      <span class="attr">counter</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">user</span>.<span class="property">counter</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// 写法2</span></span><br><span class="line">    ...<span class="title function_">mapState</span>(<span class="string">&#x27;user&#x27;</span>, &#123;</span><br><span class="line">      <span class="attr">counter</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">counter</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 写法3</span></span><br><span class="line"><span class="keyword">import</span> &#123; createNamespacedHelpers &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">const</span> &#123; mapState &#125; = <span class="title function_">createNamespacedHelpers</span>(<span class="string">&#x27;user&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">computed</span>: &#123;</span><br><span class="line">    ...<span class="title function_">mapState</span>( &#123;</span><br><span class="line">      <span class="attr">counter</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">counter</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="composition-api中针对module的重构"><a href="#composition-api中针对module的重构" class="headerlink" title="composition api中针对module的重构"></a>composition api中针对module的重构</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">useUtil</span>(<span class="params">mapper, mapperFn</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> store = <span class="title function_">useStore</span>()</span><br><span class="line">  <span class="keyword">const</span> stateFns = <span class="title function_">mapperFn</span>(mapper)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> state = &#123;&#125;</span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">keys</span>(stateFns).<span class="title function_">forEach</span>(<span class="function">(<span class="params">fnKey</span>) =&gt;</span> &#123;</span><br><span class="line">    state[fnKey] = <span class="title function_">computed</span>(stateFns[fnKey].<span class="title function_">bind</span>(&#123; <span class="attr">$store</span>: store &#125;))</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> state</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useState</span>(<span class="params">mapper, moduleId</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> stateFn = mapState</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> moduleId === <span class="string">&#x27;string&#x27;</span> &amp;&amp; moduleId.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    stateFn = <span class="title function_">createNamespacedHelpers</span>(moduleId).<span class="property">mapState</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">useUtil</span>(mapper, stateFn)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useGetters</span>(<span class="params">mapper, moduleId</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> getterFn = mapGetters</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> moduleId === <span class="string">&#x27;string&#x27;</span> &amp;&amp; moduleId.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    getterFn = <span class="title function_">createNamespacedHelpers</span>(moduleId).<span class="property">mapGetters</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">useUtil</span>(mapper, getterFn)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/01/31/vuex/" data-id="cldjpozuy000n98t402nu4cbc" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vue/" rel="tag">vue</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-vue-router" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/01/31/vue-router/" class="article-date">
  <time datetime="2023-01-31T03:20:03.000Z" itemprop="datePublished">2023-01-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/01/31/vue-router/">vue-router</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="浏览器与路由"><a href="#浏览器与路由" class="headerlink" title="浏览器与路由"></a>浏览器与路由</h1><p>路由的概念在软件工程中出现，最早是在后端路由中实现的，原因是web的发展主要经历了这样一些阶段</p>
<ul>
<li>后端路由阶段</li>
<li>前后端分离阶段</li>
<li>单页面富应用（SPA）</li>
</ul>
<h2 id="URL的hash"><a href="#URL的hash" class="headerlink" title="URL的hash"></a>URL的hash</h2><p>前端路由是如何做到URL和内容进行映射呢？监听URL的改变。</p>
<p>URL的hash</p>
<ul>
<li>URL的hash也就是锚点(#), 本质上是改变window.location的href属性</li>
<li>我们可以通过直接赋值location.hash来改变href, 但是页面不发生刷新</li>
</ul>
<p>hash的优势就是兼容性更好，在老版IE中都可以运行，但是缺陷是有一个#，显得不像一个真实的路径</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#/home&quot;</span>&gt;</span>home<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#/about&quot;</span>&gt;</span>about<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">      default</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> contentEl = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.content&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;hashchange&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">switch</span> (location.<span class="property">hash</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">case</span> <span class="string">&#x27;#/home&#x27;</span>: contentEl.<span class="property">innerHTML</span> = <span class="string">&#x27;home&#x27;</span>;<span class="keyword">break</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">case</span> <span class="string">&#x27;#/about&#x27;</span>: contentEl.<span class="property">innerHTML</span> = <span class="string">&#x27;about&#x27;</span>;<span class="keyword">break</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">default</span>: contentEl.<span class="property">innerHTML</span> = <span class="string">&#x27;default&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="HTML5的History"><a href="#HTML5的History" class="headerlink" title="HTML5的History"></a>HTML5的History</h2><p>history接口是HTML5新增的, 它有l六种模式改变URL而不刷新页面</p>
<ul>
<li>replaceState(state, title[, url])：替换原来的路径（直接替换，不压栈）</li>
<li>pushState(state, title[, url])：使用新的路径（会压栈）</li>
<li>popState：路径的回退</li>
<li>go：向前或向后改变路径</li>
<li>forward：向前改变路径</li>
<li>back：向后改变路径</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/home&quot;</span>&gt;</span>home<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/about&quot;</span>&gt;</span>about<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">    default</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> contentEl = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.content&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> aEls = <span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&#x27;a&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">for</span> (<span class="keyword">const</span> el <span class="keyword">of</span> aEls) &#123;</span></span><br><span class="line"><span class="language-javascript">    el.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      e.<span class="title function_">preventDefault</span>()</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> href = el.<span class="title function_">getAttribute</span>(<span class="string">&#x27;href&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">      history.<span class="title function_">pushState</span>(&#123;&#125;, <span class="string">&#x27;&#x27;</span>, href)</span></span><br><span class="line"><span class="language-javascript">      history.<span class="title function_">replaceState</span>()</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">switch</span> (location.<span class="property">pathname</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">case</span> <span class="string">&#x27;/home&#x27;</span>: contentEl.<span class="property">innerHTML</span> = <span class="string">&#x27;home&#x27;</span>;<span class="keyword">break</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">case</span> <span class="string">&#x27;/about&#x27;</span>: contentEl.<span class="property">innerHTML</span> = <span class="string">&#x27;about&#x27;</span>;<span class="keyword">break</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">default</span>: contentEl.<span class="property">innerHTML</span> = <span class="string">&#x27;default&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="vue-router"><a href="#vue-router" class="headerlink" title="vue-router"></a>vue-router</h1><p>Vue Router 是 Vue.js 的官方路由。它与 Vue.js 核心深度集成，让用 Vue.js 构建单页应用变得非常容易</p>
<p>vue-router是基于路由和组件的</p>
<ul>
<li>路由用于设定访问路径, 将路径和组件映射起来</li>
<li>在vue-router的单页面应用中, 页面的路径的改变就是组件的切换.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install vue-router</span><br></pre></td></tr></table></figure>

<h2 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a>使用步骤</h2><p>使用vue-router的步骤:</p>
<ul>
<li>第一步：创建路由组件的组件</li>
<li>第二步：配置路由映射: 组件和路径映射关系的routes数组</li>
<li>第三步：通过createRouter创建路由对象，并且传入routes和history模式<ul>
<li>createWebHistory为history模式</li>
<li>createWebHashHistory为hash模式</li>
</ul>
</li>
<li>第四步：使用路由: 通过<code>&lt;router-link&gt;</code>和<code>&lt;router-view&gt;</code><ul>
<li>其中内容会渲染到<code>&lt;router-view&gt;</code></li>
<li>可以通过<code>&lt;router-link&gt;</code>或者<code>$router</code>的方法进行路由切换</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createRouter, createWebHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="comment">// 导入组件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Home</span> <span class="keyword">from</span> <span class="string">&#x27;../views/Home.vue&#x27;</span></span><br><span class="line"><span class="comment">// 配置路由映射</span></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Home&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">Home</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/about&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;About&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: &quot;about&quot; */</span> <span class="string">&#x27;../views/About.vue&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"><span class="comment">// 创建router对象</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">  <span class="attr">history</span>: <span class="title function_">createWebHistory</span>(process.<span class="property">env</span>.<span class="property">BASE_URL</span>), <span class="comment">// history模式</span></span><br><span class="line">  routes</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 抛出 外层实例直接use即可</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 下面是模板 --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;nav&quot;&gt;</span><br><span class="line">    &lt;router-link to=&quot;/&quot;&gt;Home&lt;/router-link&gt; |</span><br><span class="line">    &lt;router-link to=&quot;/about&quot;&gt;About&lt;/router-link&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;!-- 内容会渲染到这里 --&gt;</span><br><span class="line">  &lt;router-view/&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<h2 id="默认路径和重定向"><a href="#默认路径和重定向" class="headerlink" title="默认路径和重定向"></a>默认路径和重定向</h2><p>path配置的是根路径: /</p>
<p>redirect是重定向</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,<span class="attr">redirect</span>: <span class="string">&#x27;/home&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;/home&#x27;</span>,<span class="attr">name</span>: <span class="string">&#x27;Home&#x27;</span>,<span class="attr">component</span>: <span class="title class_">Home</span> &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="路由懒加载"><a href="#路由懒加载" class="headerlink" title="路由懒加载"></a>路由懒加载</h2><p>当打包构建应用时，JavaScript 包会变得非常大，影响页面加载</p>
<ul>
<li>如果我们能把不同路由对应的组件分割成不同的代码块，然后当路由被访问的时候才加载对应组件，这样就会更加高效</li>
<li>也可以提高首屏的渲染效率</li>
</ul>
<p>其实这里还是我们前面讲到过的webpack的分包知识，而Vue Router默认就支持动态来导入组件</p>
<ul>
<li>这是因为component可以传入一个组件，也可以接收一个函数，该函数 需要放回一个Promise</li>
<li>而import函数就是返回一个Promise</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line"> &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/about&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;About&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/About.vue&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="打包chunk"><a href="#打包chunk" class="headerlink" title="打包chunk"></a>打包chunk</h2><p>如果我们使用路由懒加载的时候，分包可能是没有一个很明确的名称的</p>
<p>webpack从3.x开始支持对分包进行命名（chunk name），只需要在import前面内部加上注释<br><code>/* webpackChunkName: &quot;打包文件名称&quot; */</code>，即可对分包命名</p>
<p>以下面路由为例</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,<span class="attr">redirect</span>: <span class="string">&#x27;/home&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;/home&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;Home&#x27;</span>, <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/Home.vue&#x27;</span>) &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;/about&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;About&#x27;</span>, <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: &quot;about&quot; */</span> <span class="string">&#x27;../views/About.vue&#x27;</span>) &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>打包之后会生成<br>about组件：about.1041c584.js<br>home组件：chunk-c5902d70.0489b66f.js</p>
<h2 id="动态路由基本匹配"><a href="#动态路由基本匹配" class="headerlink" title="动态路由基本匹配"></a>动态路由基本匹配</h2><p>很多时候我们需要将给定匹配模式的路由映射到同一个组件</p>
<ul>
<li>例如，我们可能有一个 User 组件，它应该对所有用户进行渲染，但是用户的ID是不同的</li>
<li>在Vue Router中，我们可以在路径中使用一个动态字段来实现，我们称之为 路径参数</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;/user/:id&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;User&#x27;</span>, <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/user.vue&#x27;</span>) &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>此时对于任意 /user/xxx的路由都能匹配，参数可以通过params方式获取</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// options api</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// composition api</span></span><br><span class="line"><span class="keyword">import</span> &#123; useRoute &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>()</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">new</span> <span class="title function_">useRoute</span>().<span class="property">params</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="匹配多个参数时"><a href="#匹配多个参数时" class="headerlink" title="匹配多个参数时"></a>匹配多个参数时</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;/user/:id/info/:name&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;User&#x27;</span>, <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/user.vue&#x27;</span>) &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>如果此时的路由为<code>/user/123/info/test</code>， 则返回值为<code>&#123; id: &#39;123&#39;, name: &#39;test&#39; &#125;</code></p>
<h2 id="通配符路由"><a href="#通配符路由" class="headerlink" title="通配符路由"></a>通配符路由</h2><p>常规参数只匹配 url 片段之间的字符，用 / 分隔。如果我们想匹配任意路径，我们可以使用自定义的 路径参数 正则表达式，在 路径参数 后面的括号中加入 正则表达式 :</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  <span class="comment">// 将匹配所有内容并将其放在 `$route.params.pathMatch` 下</span></span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;/:pathMatch(.*)&#x27;</span>, <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>( <span class="string">&#x27;../views/NotFound.vue&#x27;</span>) &#125;,</span><br><span class="line">  <span class="comment">// 将匹配以 `/user-` 开头的所有内容，并将其放在 `$route.params.afterUser` 下</span></span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;/user-:afterUser(.*)&#x27;</span>, <span class="attr">component</span>: <span class="title class_">UserGeneric</span> &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>如果在<code>/:pathMatch(.*)</code>后面又加了一个 <code>*</code>，仍然能匹配，但是返回值会不同<br>对于/user/abcd/123</p>
<ul>
<li><code>/:pathMatch(.*)</code>：返回 <code>/user/abcd/123</code></li>
<li><code>/:pathMatch(.*)*</code>：返回 <code>[&#39;user&#39;, &#39;abcd&#39;, &#39;123&#39;]</code></li>
</ul>
<h2 id="路由嵌套"><a href="#路由嵌套" class="headerlink" title="路由嵌套"></a>路由嵌套</h2><p>目前我们匹配的Home、About、User等都属于底层路由，我们在它们之间可以来回进行切换</p>
<p>但是，我们Home页面本身，也可能会在多个组件之间来回切换</p>
<ul>
<li>比如Home中包括Product、Message，它们可以在Home内部来回切换</li>
</ul>
<p>这个时候我们就需要使用嵌套路由，在Home中也使用 router-view 来占位之后需要渲染的组件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/user/:id&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">User</span>,</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 当 /user/:id/profile 匹配成功</span></span><br><span class="line">        <span class="comment">// UserProfile 将被渲染到 User 的 &lt;router-view&gt; 内部</span></span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;profile&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="title class_">UserProfile</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><strong>在嵌套路由中，如果以 / 开头的嵌套路径将被视为根路径。这允许你利用组件嵌套，而不必使用嵌套的 URL</strong></p>
<p>举例，对于profile</p>
<ul>
<li><code>path: &#39;profile&#39;</code>：匹配<code>/user/:id/profile</code></li>
<li><code>path: &#39;/profile&#39;</code>：匹配<code>/profile</code>，并且如果父级路由是params模式会报错</li>
</ul>
<h2 id="路由参数"><a href="#路由参数" class="headerlink" title="路由参数"></a>路由参数</h2><h3 id="query方式"><a href="#query方式" class="headerlink" title="query方式"></a>query方式</h3><p>url以<code>?key=value&amp;...</code>的方式存储的参数<br>代码中以<code>$route.query[key]</code>获取</p>
<h3 id="params方式"><a href="#params方式" class="headerlink" title="params方式"></a>params方式</h3><p>路由以<code>/:key</code>匹配的时候<br>代码中以<code>$route.params[key]</code>获取</p>
<h2 id="router-link"><a href="#router-link" class="headerlink" title="router-link"></a>router-link</h2><h3 id="常见属性"><a href="#常见属性" class="headerlink" title="常见属性"></a>常见属性</h3><ul>
<li>to：是一个字符串，或者是一个对象</li>
<li>replace：设置 replace 属性的话，当点击时，会调用 router.replace()，而不是 router.push()</li>
<li>active-class：设置激活a元素后应用的class，默认是router-link-active</li>
<li>exact-active-class：路由精准匹配时，应用于渲染的<code>&lt;a&gt;</code>的 class，默认是router-link-exact-active<ul>
<li>常见于嵌套路由中，此时子级路由精准匹配，有exact-active-class；父级路由不是精准匹配，没有exact-active-class</li>
</ul>
</li>
</ul>
<h3 id="自定义元素"><a href="#自定义元素" class="headerlink" title="自定义元素"></a>自定义元素</h3><p>在vue-router3.x的时候，router-link有一个tag属性，可以决定router-link到底渲染成什么元素<br>但是在vue-router4.x开始，该属性被移除了<br>而给我们提供了更加具有灵活性的v-slot的方式来定制渲染的内容</p>
<p>使用方式如下：</p>
<ul>
<li>首先，我们需要使用custom表示我们整个元素要自定义<ul>
<li>此时不会有根元素包裹，如果里面需要包含多个元素时，尽量先用根元素包裹</li>
<li>如果不写，那么自定义的内容会被包裹在一个 a 元素中</li>
</ul>
</li>
<li>其次，我们使用v-slot来作用域插槽来获取内部传给我们的值<ul>
<li>href：解析后的 URL</li>
<li>route：解析后的规范化的route对象；</li>
<li>navigate：触发导航的函数，可以直接赋值给click事件</li>
<li>isActive：是否匹配的状态</li>
<li>isExactActive：是否是精准匹配的状态</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;router-link to=&quot;/about&quot; v-slot=&quot;&#123; navigate &#125;&quot; custom&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;button @click=&quot;navigate&quot;&gt;去about&lt;/button&gt;</span><br><span class="line">    aaaaaa</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/router-link&gt;</span><br></pre></td></tr></table></figure>

<h2 id="router-view"><a href="#router-view" class="headerlink" title="router-view"></a>router-view</h2><h3 id="常见属性-1"><a href="#常见属性-1" class="headerlink" title="常见属性"></a>常见属性</h3><ul>
<li>name: 如果 <code>&lt;router-view&gt;</code> 设置了 name，则会渲染对应的路由配置中 components 下的相应组件</li>
<li>route: 一个路由地址的所有组件都已被解析（如果所有组件都被懒加载），因此可以显示</li>
</ul>
<h3 id="自定义元素-1"><a href="#自定义元素-1" class="headerlink" title="自定义元素"></a>自定义元素</h3><p>router-view也提供给我们一个插槽，可以用于 <code>&lt;transition&gt;</code> 和 <code>&lt;keep-alive&gt;</code> 组件来包裹你的路由组件</p>
<ul>
<li>Component：要渲染的组件</li>
<li>route：解析出的标准化路由对象</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;router-view v-slot=&quot;&#123; Component &#125;&quot;&gt;</span><br><span class="line">  &lt;transition name=&quot;number&quot;&gt;</span><br><span class="line">    &lt;keep-alive&gt;</span><br><span class="line">      &lt;component :is=&quot;Component&quot; /&gt;</span><br><span class="line">    &lt;/keep-alive&gt;</span><br><span class="line">  &lt;/transition&gt;</span><br><span class="line">&lt;/router-view&gt;</span><br></pre></td></tr></table></figure>

<h2 id="动态增加路由"><a href="#动态增加路由" class="headerlink" title="动态增加路由"></a>动态增加路由</h2><p>某些情况下我们可能需要动态的来添加路由</p>
<ul>
<li>比如根据用户不同的权限，注册不同的路由</li>
<li>这个时候我们可以使用一个方法 addRoute</li>
</ul>
<p>默认情况下，直接传入一个对象会把路由添加在一级路由上<br>如果我们传入一个路由的名字(比如’home’)，这样路由会添加在’home’下作为子级路由</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">  <span class="attr">history</span>: <span class="title function_">createWebHistory</span>(process.<span class="property">env</span>.<span class="property">BASE_URL</span>),</span><br><span class="line">  routes</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> categoryRoute1 = &#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/category&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: &quot;categoryRoute&quot; */</span> <span class="string">&#x27;../views/category/category1.vue&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> categoryRoute2 = &#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/category&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: &quot;categoryRoute&quot; */</span> <span class="string">&#x27;../views/category/category2.vue&#x27;</span>),</span><br><span class="line">  <span class="attr">children</span>: []</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">addRoute</span>(categoryRoute1) <span class="comment">// 添加到一级路由</span></span><br><span class="line">router.<span class="title function_">addRoute</span>(<span class="string">&#x27;home&#x27;</span>, categoryRoute2) <span class="comment">// 添加到home下的二级路由</span></span><br></pre></td></tr></table></figure>

<h2 id="动态删除路由"><a href="#动态删除路由" class="headerlink" title="动态删除路由"></a>动态删除路由</h2><p>删除路由有以下三种方式</p>
<ul>
<li>方式一：添加一个name相同的路由（相当于替换路由达到删除效果）</li>
<li>方式二：通过removeRoute方法，传入路由的名称</li>
<li>方式三：通过addRoute方法的返回值回调</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">  <span class="attr">history</span>: <span class="title function_">createWebHistory</span>(process.<span class="property">env</span>.<span class="property">BASE_URL</span>),</span><br><span class="line">  routes</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> categoryRoute = &#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/category&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;category&#x27;</span></span><br><span class="line">  <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: &quot;categoryRoute&quot; */</span> <span class="string">&#x27;../views/category/category1.vue&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> removeCategory = router.<span class="title function_">addRoute</span>(categoryRoute) <span class="comment">// 添加到一级路由</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法二</span></span><br><span class="line">router.<span class="title function_">removeRoute</span>(<span class="string">&#x27;category&#x27;</span>)</span><br><span class="line"><span class="comment">// 方法三</span></span><br><span class="line"><span class="title function_">removeCategory</span>()</span><br></pre></td></tr></table></figure>

<h2 id="路由导航守卫"><a href="#路由导航守卫" class="headerlink" title="路由导航守卫"></a>路由导航守卫</h2><p>vue-router 提供的导航守卫主要用来通过跳转或取消的方式守卫导航</p>
<p>全局的前置守卫beforeEach是在导航触发时会被回调的</p>
<p>它有两个参数</p>
<ul>
<li>to：即将进入的路由Route对象</li>
<li>from：即将离开的路由Route对象</li>
</ul>
<p>它有返回值</p>
<ul>
<li>false：取消当前导航</li>
<li>不返回或者undefined：进行默认导航</li>
<li>返回一个路由地址<ul>
<li>可以是一个string类型的路径</li>
<li>可以是一个对象，对象中包含path、query、params等信息</li>
</ul>
</li>
</ul>
<p>可选的第三个参数：next</p>
<ul>
<li>在Vue2中我们是通过next函数来决定如何进行跳转的</li>
<li>但是在Vue3中我们是通过返回值来控制的，不再推荐使用next函数，这是因为开发中很容易调用多次next</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (to.<span class="property">path</span>.<span class="title function_">indexOf</span>(<span class="string">&#x27;/home&#x27;</span>) !== -<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;/login&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="router方法总结"><a href="#router方法总结" class="headerlink" title="router方法总结"></a>router方法总结</h2><ul>
<li>router.hasRoute()：检查路由是否存在</li>
<li>router.getRoutes()：获取一个包含所有路由记录的数组</li>
</ul>
<h2 id="route对象属性总结"><a href="#route对象属性总结" class="headerlink" title="route对象属性总结"></a>route对象属性总结</h2><ul>
<li>path: </li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/01/31/vue-router/" data-id="cldjpozux000j98t44nt9fpvx" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/router/" rel="tag">router</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vue/" rel="tag">vue</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-vue3源码解析" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2023/01/31/vue3%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" class="article-date">
  <time datetime="2023-01-31T03:19:57.000Z" itemprop="datePublished">2023-01-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2023/01/31/vue3%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/">vue3源码解析</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="虚拟dom"><a href="#虚拟dom" class="headerlink" title="虚拟dom"></a>虚拟dom</h1><p>以javascript对象表示为document对象</p>
<h2 id="虚拟dom的优势"><a href="#虚拟dom的优势" class="headerlink" title="虚拟dom的优势"></a>虚拟dom的优势</h2><p>目前框架都会引入虚拟DOM来对真实的DOM进行抽象，这样做有很多的好处</p>
<p>首先是可以对真实的元素节点进行抽象，抽象成VNode（虚拟节点），这样方便后续对其进行各种操作</p>
<ul>
<li>因为对于直接操作DOM来说是有很多的限制的，比如diff、clone等等，但是使用JavaScript编程语言来操作这些，就变得非常的简单</li>
<li>我们可以使用JavaScript来表达非常多的逻辑，而对于DOM本身来说是非常不方便的</li>
</ul>
<p>其次是方便实现跨平台，包括你可以将VNode节点渲染成任意你想要的节点</p>
<ul>
<li>如渲染在canvas、WebGL、SSR、Native（iOS、Android）上</li>
<li>并且Vue允许你开发属于自己的渲染器（renderer），在其他的平台上渲染</li>
</ul>
<h1 id="vue源码"><a href="#vue源码" class="headerlink" title="vue源码"></a>vue源码</h1><p>事实上Vue的源码包含三大核心</p>
<ul>
<li>Compiler模块：编译模板系统，源码中为<code>Compiler-xxx</code>的部分</li>
<li>Runtime模块：也可以称之为Renderer模块，真正渲染的模块，源码中为<code>Runtime-xxx</code>的部分</li>
<li>Reactivity模块：响应式系统</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/01/31/vue3%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" data-id="cldjpozux000l98t48plq3lr9" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vue/" rel="tag">vue</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%BA%90%E7%A0%81/" rel="tag">源码</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">下一页 &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/element-ui/" rel="tag">element-ui</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/npm/" rel="tag">npm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/router/" rel="tag">router</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue3/" rel="tag">vue3</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%A8%A1%E5%9D%97%E5%8C%96/" rel="tag">模块化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/" rel="tag">浏览器</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BA%90%E7%A0%81/" rel="tag">源码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%85%8D%E7%BD%AE/" rel="tag">配置</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/element-ui/" style="font-size: 10px;">element-ui</a> <a href="/tags/javascript/" style="font-size: 20px;">javascript</a> <a href="/tags/npm/" style="font-size: 10px;">npm</a> <a href="/tags/router/" style="font-size: 10px;">router</a> <a href="/tags/vue/" style="font-size: 17.5px;">vue</a> <a href="/tags/vue3/" style="font-size: 10px;">vue3</a> <a href="/tags/%E6%A8%A1%E5%9D%97%E5%8C%96/" style="font-size: 10px;">模块化</a> <a href="/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/" style="font-size: 12.5px;">浏览器</a> <a href="/tags/%E6%BA%90%E7%A0%81/" style="font-size: 15px;">源码</a> <a href="/tags/%E9%85%8D%E7%BD%AE/" style="font-size: 10px;">配置</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">一月 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/01/31/js%E4%B8%AD%E5%B1%9E%E6%80%A7%E6%8F%8F%E8%BF%B0%E7%AC%A6%E4%B8%8E%E5%AF%B9%E8%B1%A1%E7%8A%B6%E6%80%81/">js中属性描述符与对象状态</a>
          </li>
        
          <li>
            <a href="/2023/01/31/%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF/">事件循环</a>
          </li>
        
          <li>
            <a href="/2023/01/31/js%E4%B8%AD%E7%9A%84%E6%B5%85%E6%8B%B7%E8%B4%9D%E4%B8%8E%E6%B7%B1%E6%8B%B7%E8%B4%9D/">js中的浅拷贝与深拷贝</a>
          </li>
        
          <li>
            <a href="/2023/01/31/%E9%89%B4%E6%9D%83%E5%92%8C%E5%9C%A8node%E4%B8%8A%E7%9A%84%E5%AE%9E%E7%8E%B0/">鉴权和在node上的实现</a>
          </li>
        
          <li>
            <a href="/2023/01/31/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6%EF%BC%88GC%EF%BC%89/">垃圾回收机制（GC）</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2023 月夜静翼<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>